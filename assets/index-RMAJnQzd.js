(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const On="modulepreload",Mn=function(n){return"/private_notes/"+n},Gt={},rt=function(e,o,a){let i=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(o.map(c=>{if(c=Mn(c),c in Gt)return;Gt[c]=!0;const d=c.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":On,d||(u.as="script"),u.crossOrigin="",u.href=c,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((y,h)=>{u.addEventListener("load",y),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return i.then(s=>{for(const l of s||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};class O{static async hash(e,o="salt_cloud_notes_2026"){const i=new TextEncoder().encode(e+o),r=await crypto.subtle.digest("SHA-512",i);return Array.from(new Uint8Array(r)).map(l=>l.toString(16).padStart(2,"0")).join("")}static async deriveVaultKey(e){return await this.hash(e,"vault_v3_internal_key")}static async compress(e){const a=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(a).arrayBuffer()}static async decompress(e){const a=new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(a).text()}static async deriveKey(e,o){const a=new TextEncoder,i=await crypto.subtle.importKey("raw",a.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode(o),iterations:25e4,hash:"SHA-512"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,o,a={algo:"aes-256-gcm"}){try{const i=crypto.getRandomValues(new Uint8Array(16)),r=crypto.getRandomValues(new Uint8Array(12)),s=await this.deriveKey(o,this.bufToBase64(i)),l=typeof e=="string"?e:JSON.stringify(e),c=await this.compress(l),d=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},s,c);return{payload:this.bufToBase64(new Uint8Array(d)),iv:this.bufToBase64(r),salt:this.bufToBase64(i),algo:a.algo||"aes-256-gcm",compressed:!0,v:"4.0"}}catch(i){throw console.error("[Security] Encryption failed:",i),new Error("No se pudo encriptar la informaci√≥n")}}static async decrypt(e,o){try{if(!e||!e.payload||!e.iv||!e.salt)throw new Error("Formato de datos encriptados inv√°lido");const{payload:a,iv:i,salt:r,compressed:s}=e,l=await this.deriveKey(o,r),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.base64ToBuf(i)},l,this.base64ToBuf(a)),d=s?await this.decompress(c):new TextDecoder().decode(c);try{return JSON.parse(d)}catch{return d}}catch(a){throw console.error("[Security] Decryption failed:",a),new Error("Contrase√±a incorrecta o datos corruptos")}}static bufToBase64(e){return btoa(String.fromCharCode(...new Uint8Array(e)))}static base64ToBuf(e){return new Uint8Array(atob(e).split("").map(o=>o.charCodeAt(0)))}}const Hn=Object.freeze(Object.defineProperty({__proto__:null,SecurityService:O},Symbol.toStringTag,{value:"Module"})),p={notes:[],categories:[],settings:{theme:"dark",drivePath:"/backup/notes/",algo:"aes-256-gcm",notesPerChunk:50},currentView:"all",editingNoteId:null,unlockedNotes:new Set,unlockedCategories:new Set,gapiLoaded:!1,tokenClient:null};async function Z(){const n=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(n){const e=await O.encrypt(p.notes,n),o=await O.encrypt(p.categories,n);localStorage.setItem("cn_notes_v3_enc",JSON.stringify(e)),localStorage.setItem("cn_categories_v3_enc",JSON.stringify(o)),localStorage.removeItem("cn_notes_v3"),localStorage.removeItem("cn_categories_v3")}localStorage.setItem("cn_settings_v3",JSON.stringify(p.settings))}async function jn(n){try{const e=localStorage.getItem("cn_notes_v3_enc"),o=localStorage.getItem("cn_categories_v3_enc");if(e)p.notes=await O.decrypt(JSON.parse(e),n);else{const a=localStorage.getItem("cn_notes_v3");a&&(p.notes=JSON.parse(a))}if(o)p.categories=await O.decrypt(JSON.parse(o),n);else{const a=localStorage.getItem("cn_categories_v3");a&&(p.categories=JSON.parse(a))}}catch(e){throw console.error("Failed to load encrypted data",e),e}}function Rn(){const n=localStorage.getItem("cn_settings_v3");n&&(p.settings={...p.settings,...JSON.parse(n)},p.settings.syncChunkSize!==void 0&&(p.settings.notesPerChunk||(p.settings.notesPerChunk=50),delete p.settings.syncChunkSize))}const Me="v3.6.58",Xe=[{id:"default",light:"#ffffff",dark:"#09090b"},{id:"red",light:"#fef2f2",dark:"#450a0a"},{id:"orange",light:"#fff7ed",dark:"#431407"},{id:"yellow",light:"#fefce8",dark:"#422006"},{id:"green",light:"#f0fdf4",dark:"#064e3b"},{id:"teal",light:"#f0fdfa",dark:"#134e4a"},{id:"blue",light:"#eff6ff",dark:"#1e3a8a"},{id:"darkblue",light:"#eef2ff",dark:"#1e1b4b"},{id:"purple",light:"#faf5ff",dark:"#3b0764"},{id:"pink",light:"#fdf2f8",dark:"#500724"},{id:"brown",light:"#fffaf5",dark:"#2d1a10"},{id:"gold",light:"#fef3c7",dark:"#451a03"},{id:"rose",light:"#fff1f2",dark:"#4c0519"},{id:"indigo",light:"#eef2ff",dark:"#312e81"},{id:"slate",light:"#f1f5f9",dark:"#1e293b"},{id:"gray",light:"#f8fafc",dark:"#0f172a"}],Fn=["#ffffff","#f28b82","#fbbc04","#fff475","#ccff90","#a7ffeb","#cbf0f8","#aecbfa","#d7aefb","#fdcfe8","#e6c9a8","#e8eaed","#6366f1","#ec4899","#f43f5e","#10b981","#f59e0b","#06b6d4","#1e293b","#450a0a","#422006","#064e3b","#134e4a","#1e3a8a","#1e1b4b","#4c1d95","#500724","#27272a","#09090b","#312e81"],zn=["üòä","üòÇ","ü•∞","üòé","ü§î","üò¥","üî•","‚ú®","üöÄ","üéâ","‚ù§Ô∏è","üëç","üí°","üìÖ","‚úÖ","‚ùå","üîí","üîë","üìå","üé®","üìÅ","üè†","üåü","üåç","üíª","üì±","üçé","üçï","üç∫","üåà","‚òÄÔ∏è","üåô","‚ö°","üíé","üéÅ","üéà","üéµ","üì∑","üîç","üõ∏","üëæ","ü§ñ","üëª","ü¶Ñ","üêæ","üèÄ","‚öΩ","üöó","‚úàÔ∏è","üïπÔ∏è","üéÆ","üé≤","üß©","üé≠","üé¨","üé§","üéß","üéπ","üé∏","üéª","üé∫","üé∑","ü•Å","üèπ","üé£","üöµ","üßó","üßò","üõÅ","üõå","üóùÔ∏è","üõ°Ô∏è","‚öîÔ∏è","üó∫Ô∏è","üïØÔ∏è","‚åõ","‚öñÔ∏è","‚öôÔ∏è","‚öíÔ∏è","üõ†Ô∏è","‚õèÔ∏è","‚õìÔ∏è","üî≠","üî¨","üíä","üíâ","üß¨","ü©∏","üß™","üå°Ô∏è","üß¥","üßπ","üß∫","üßº","üßΩ","ü™£","ü™í","üßª","üõÄ","üöø","üöΩ"],qn=["tag","briefcase","home","user","heart","star","shopping-cart","book","code","coffee","graduation-cap","music","camera","plane","bike","gift","bell","calendar","map-pin","search","folder","database","globe","terminal","cpu","layers","layout","activity","archive","award","bar-chart","bookmark","box","briefcase","check-circle","clock","cloud","compass","edit","external-link","eye","file-text","flag","folder-open","image","info","key","life-buoy","link","list","mail","message-circle","mic","monitor","moon","mouse-pointer","package","paperclip","phone","pie-chart","play","plus","printer","save","send","settings","share-2","shield","shopping-bag","slack","smartphone","speaker","sun","tablet","target","tool","truck","tv","umbrella","video","watch","wifi","zap"];function I(n,e=3e3){const o=document.getElementById("toast");o&&(o.querySelector("div").innerText=n,o.classList.add("show"),setTimeout(()=>o.classList.remove("show"),e))}function oe(n,e=!1){return new Promise(o=>{const a=document.getElementById("prompt-modal"),i=document.getElementById("prompt-input"),r=document.getElementById("prompt-label"),s=document.getElementById("prompt-confirm"),l=document.getElementById("prompt-cancel"),c=document.getElementById("prompt-biometric"),d=document.getElementById("prompt-toggle-visibility");if(!a||!i||!r||!s||!l||!c||!d)return console.error("One or more prompt elements not found."),o(null);r.textContent=n,i.value="",i.type=e?"password":"text",e?(d.classList.remove("hidden"),i.placeholder="Enter password",i.classList.add("text-center","tracking-widest")):(d.classList.add("hidden"),i.placeholder="Type here...",i.classList.remove("text-center","tracking-widest"));const g=localStorage.getItem("cn_bio_enabled")==="true";window.PublicKeyCredential&&g&&e?(c.classList.remove("hidden"),setTimeout(()=>{c.click()},300)):c.classList.add("hidden"),c.onclick=async()=>{try{const b=new Uint8Array(32);window.crypto.getRandomValues(b),await navigator.credentials.get({publicKey:{challenge:b,rpId:window.location.hostname,userVerification:"required",timeout:6e4}}),u(),o({biometric:!0})}catch(b){console.error("Biometric auth failed:",b);try{const _=new Uint8Array(32);window.crypto.getRandomValues(_),await navigator.credentials.create({publicKey:{challenge:_,rp:{name:"Private Notes",id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}}),u(),o({biometric:!0})}catch(_){console.error("Biometric create failed:",_),I("‚ùå Biometric authentication failed")}}},d.onclick=()=>{i.type==="password"?(i.type="text",d.innerHTML='<i data-lucide="eye"></i>'):(i.type="password",d.innerHTML='<i data-lucide="eye-off"></i>'),q()},a.classList.remove("hidden"),q(),i.focus();const u=()=>{a.classList.add("hidden"),window.removeEventListener("keydown",y)},y=b=>{b.key==="Enter"&&h(),b.key==="Escape"&&f()};window.addEventListener("keydown",y);const h=()=>{const b=i.value;u(),o(b)},f=()=>{u(),o(null)};document.getElementById("prompt-confirm").onclick=h,document.getElementById("prompt-cancel").onclick=f})}function dn(n){if(!n)return!0;const e=n.replace("#",""),o=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return isNaN(o)||isNaN(a)||isNaN(i)?!0:(o*299+a*587+i*114)/1e3<128}function q(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}const Wt=Object.freeze(Object.defineProperty({__proto__:null,isColorDark:dn,openPrompt:oe,safeCreateIcons:q,showToast:I},Symbol.toStringTag,{value:"Module"}));class un{constructor(e="notev3_",o="/backup/notes/",a=50){this.basePath=o,this.dbPrefix=e,this.notesPerChunk=a,this.metaFile=e+"meta_v4.bin",this.groupPrefix=e+"group_v4_"}async getOrCreateFolder(e){const o=e.split("/").filter(i=>i);let a="root";for(const i of o){const r=`name = '${i}' and mimeType = 'application/vnd.google-apps.folder' and '${a}' in parents and trashed = false`,l=(await gapi.client.drive.files.list({q:r,fields:"files(id, name)"})).result.files;if(l.length>0)a=l[0].id;else{const c={name:i,mimeType:"application/vnd.google-apps.folder",parents:[a]};a=(await gapi.client.drive.files.create({resource:c,fields:"id"})).result.id}}return a}async calculateHash(e){const o=JSON.stringify(e),a=new TextEncoder().encode(o),i=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("")}async saveChunks(e,o,a,i){console.log(`[Drive] Saving ${e.length} notes in groups of ${this.notesPerChunk}`);const r=`'${i}' in parents and trashed = false`,l=(await gapi.client.drive.files.list({q:r,fields:"files(id, name)"})).result.files||[],c=new Map(l.map(b=>[b.name,b.id]));let d=null;const g=c.get(this.metaFile);if(g)try{const b=gapi.auth.getToken().access_token,_=`https://www.googleapis.com/drive/v3/files/${g}?alt=media`,x=await(await fetch(_,{headers:{Authorization:`Bearer ${b}`}})).json();d=await O.decrypt(x,a)}catch{console.log("Failed to load previous meta.")}const u={},y=[];for(let b=0;b<e.length;b+=this.notesPerChunk)y.push(e.slice(b,b+this.notesPerChunk));for(let b=0;b<y.length;b++){const _=await this.calculateHash(y[b]);u[b]=_;const B=!d||!d.groupHashes||d.groupHashes[b]!==_,x=`${this.groupPrefix}${b.toString().padStart(5,"0")}.bin`;if(B||!c.has(x)){const w=await O.encrypt(y[b],a);await this.uploadFileWithId(x,JSON.stringify(w),i,c.get(x)),console.log(`[Drive] ${c.has(x)?"Updated":"Created"} ${x}`)}}if(d&&d.groupHashes){const b=Object.keys(d.groupHashes).map(Number);for(const _ of b)if(_>=y.length){const B=`${this.groupPrefix}${_.toString().padStart(5,"0")}.bin`,x=c.get(B);x&&(await gapi.client.drive.files.delete({fileId:x}),console.log(`[Drive] Deleted orphaned group: ${B}`))}}const h={categories:o,groupHashes:u},f=await O.encrypt(h,a);return await this.uploadFileWithId(this.metaFile,JSON.stringify(f),i,g),console.log("[Drive] Push complete."),y.length}async loadChunks(e,o){const a=`'${e}' in parents and trashed = false`,r=(await gapi.client.drive.files.list({q:a,fields:"files(id, name)"})).result.files||[],s=new Map(r.map(g=>[g.name,g.id])),l=s.get(this.metaFile);if(l)try{const g=gapi.auth.getToken().access_token,u=`https://www.googleapis.com/drive/v3/files/${l}?alt=media`,h=await(await fetch(u,{headers:{Authorization:`Bearer ${g}`}})).json(),f=await O.decrypt(h,o);console.log(`[Drive] Loading v4 data. Groups: ${Object.keys(f.groupHashes).length}`);const b=[],_=Object.keys(f.groupHashes).sort((B,x)=>B-x);for(const B of _){const x=`${this.groupPrefix}${B.toString().padStart(5,"0")}.bin`,w=s.get(x);if(w){const T=`https://www.googleapis.com/drive/v3/files/${w}?alt=media`,P=await(await fetch(T,{headers:{Authorization:`Bearer ${g}`}})).json(),R=await O.decrypt(P,o);b.push(...R)}}return{notes:b,categories:f.categories}}catch(g){console.error("[Drive] v4 Load failed",g)}const c="data_part_",d=r.filter(g=>g.name.startsWith(this.dbPrefix+c)).sort((g,u)=>g.name.localeCompare(u.name));if(d.length>0){console.log(`[Drive] Migrating ${d.length} legacy chunks...`);const g=gapi.auth.getToken().access_token;let u="";for(const y of d){const h=`https://www.googleapis.com/drive/v3/files/${y.id}?alt=media`,f=await fetch(h,{headers:{Authorization:`Bearer ${g}`}});u+=await f.text()}try{const y=JSON.parse(u);return await O.decrypt(y,o)}catch(y){console.error("[Drive] Legacy migration failed",y)}}return null}async uploadFileWithId(e,o,a,i=null){const r={name:e,parents:i?[]:[a]},s=new Blob([o],{type:"application/json"}),l=gapi.auth.getToken().access_token;if(i){const c=`https://www.googleapis.com/upload/drive/v3/files/${i}?uploadType=media`;await fetch(c,{method:"PATCH",headers:{Authorization:`Bearer ${l}`},body:s})}else{const c="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",d=new FormData;d.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),d.append("file",s),await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${l}`},body:d})}}}const pn={en:{app_name:"Private Notes",sidebar:{all_notes:"All Notes",tags:"Tags",manage_tags:"Manage Tags",settings:"Settings",install_app:"Install App",system:"System",force_reload:"Force Cleanup & Reload"},header:{search_placeholder:"Search notes...",sync:"Sync Now",install:"Install",new_note:"New Note",view_title_all:"All Notes",view_desc_all:"Organize your thoughts and protect your privacy.",pinned:"Pinned"},notes:{no_notes:"No notes here"},auth:{title:"Protected Vault",desc:"Enter your master password to continue",unlock:"Unlock",setup_title:"Setup your Vault",setup_desc:"Create a master password. Enter it twice to confirm.",create_vault:"Create my Vault",confirm_pass:"Repeat password",pass_placeholder:"Your password",repeat_placeholder:"Repeat password",remember_me:"Remember my password in this browser",problems:"Problems? Force cleanup & reload",password_mismatch:"‚ö†Ô∏è Passwords do not match!",password_short:"Password must be at least 4 chars",vault_created:"‚úÖ Vault created successfully",vault_opened:"Vault opened",incorrect_pass:"‚ùå Incorrect password",setup_pass_first:"‚ö†Ô∏è Enter your password first to configure",bio_success:"‚úÖ Biometrics activated",bio_fail:"‚ùå Biometric auth failed",bio_unlock:"Unlock with Biometrics",bio_setup:"Enable Biometrics / FaceID",use_bio:"Use Biometrics / FaceID"},editor:{title_placeholder:"Note Title",content_placeholder:"Start writing...",saving:"Saving...",saved:"Saved",error_save:"Error saving",delete_confirm:"Delete this note?",close_unsaved:"Close without saving?",tools:{bg_color:"Background Color",text_format:"Text Format"}},settings:{title:"Settings",general:"General",sync:"Cloud Sync",security:"Security",danger:"Advanced Actions",theme:"Visual Theme",light:"Light",dark:"Dark",lang:"Language",maintenance:"Maintenance",installed_version:"Installed Version",sync_status:{connected:"Connected",disconnected:"Disconnected"},connect_drive:"Connect with Google Drive",drive_folder:"Drive Folder Name",drive_folder_hint:"Notes will be encrypted inside this folder.",notes_per_chunk:"Notes per file (Group)",notes_per_chunk_hint:"Defines how many notes are grouped per file.",save_changes:"Save Changes",session_security:"Session Security",logout:"Logout",logout_hint:"Logging out clears the access key from memory.",encryption:"Encryption",algo:"Preferred Algorithm",update_algo:"Update Algorithm",reset_app:"Reset Application",reset_warning:"This will permanently delete all local notes and categories.",reset_confirm_label:'To confirm, type "confirm" below:',reset_btn:"Delete all local data",reset_keyword:"confirm"},categories:{title:"Manage Categories",add_new:"New Category",name_placeholder:"Category Name",icon_label:"Icon",color_label:"Color",password_label:"Password (Optional)",password_hint:"Leave empty for no protection",create:"Create Category",edit:"Edit Category",delete:"Delete",save:"Save Category",delete_confirm:"Delete this category? Notes will be kept but untagged.",no_category:"Uncategorized"},common:{cancel:"Cancel",confirm:"Confirm",search:"Search",search_prompt:"Enter search term:",security_prompt:"Security",security_desc_prompt:"Enter password to continue",restricted_access:"Restricted Access",enter_cat_pass:"Enter password for category",write_here:"Write here..."},biometrics:{title:"Fingerprint / Face ID",desc:"Use biometrics to unlock your vault quickly",enabled:"Enabled",disabled:"Disabled",enable_btn:"Enable",disable_btn:"Disable",setup_prompt:"Enter your master password to enable biometrics",not_supported:"Your device does not support biometrics",success_enable:"‚úÖ Biometrics enabled",success_disable:"üîì Biometrics disabled",fail_enable:"‚ùå Failed to enable biometrics",incorrect_pass:"‚ùå Incorrect password"}},es:{app_name:"Notas Privadas",sidebar:{all_notes:"Todas las notas",tags:"Etiquetas",manage_tags:"Gestionar Etiquetas",settings:"Configuraci√≥n",install_app:"Instalar Aplicaci√≥n",system:"Sistema",force_reload:"Forzar Limpieza y Recarga"},header:{search_placeholder:"Buscar notas...",sync:"Sincronizar",install:"Instalar",new_note:"Nueva Nota",view_title_all:"Todas las notas",view_desc_all:"Organiza tus pensamientos y protege tu privacidad.",pinned:"Destacadas"},notes:{no_notes:"No hay notas aqu√≠"},auth:{title:"B√≥veda Protegida",desc:"Ingresa tu contrase√±a maestra para continuar",unlock:"Desbloquear",setup_title:"Configura tu B√≥veda",setup_desc:"Crea una contrase√±a maestra. Introduce la contrase√±a dos veces para asegurar que es correcta.",create_vault:"Crear mi B√≥veda",confirm_pass:"Repite la contrase√±a",pass_placeholder:"Tu contrase√±a",repeat_placeholder:"Repite la contrase√±a",remember_me:"Recordar mi contrase√±a en este navegador",problems:"¬øProblemas? Forzar limpieza y recarga",password_mismatch:"‚ö†Ô∏è ¬°Las contrase√±as no coinciden!",password_short:"La contrase√±a debe tener al menos 4 caracteres",vault_created:"‚úÖ B√≥veda creada con √©xito",vault_opened:"B√≥veda abierta",incorrect_pass:"‚ùå Contrase√±a incorrecta",setup_pass_first:"‚ö†Ô∏è Ingresa tu contrase√±a primero para configurar",bio_success:"‚úÖ Huella activada",bio_fail:"‚ùå Autenticaci√≥n biom√©trica fallida",bio_unlock:"Desbloquear con Huella",bio_setup:"Activar Huella / FaceID",use_bio:"Usar Huella / FaceID"},editor:{title_placeholder:"T√≠tulo de la nota",content_placeholder:"Empieza a escribir...",saving:"Guardando...",saved:"Guardado",error_save:"Error al guardar",delete_confirm:"¬øEliminar esta nota?",close_unsaved:"¬øCerrar sin guardar?",tools:{bg_color:"Color de Fondo",text_format:"Formato de Texto"}},settings:{title:"Configuraci√≥n",general:"General",sync:"Sincronizaci√≥n Cloud",security:"Seguridad y Sesi√≥n",danger:"Acciones Avanzadas",theme:"Tema Visual",light:"Claro",dark:"Oscuro",lang:"Idioma",maintenance:"Mantenimiento",installed_version:"Versi√≥n Instalada",sync_status:{connected:"Conectado",disconnected:"Desconectado"},connect_drive:"Conectar con Google Drive",drive_folder:"Nombre de carpeta en Drive",drive_folder_hint:"Las notas se guardar√°n encriptadas dentro de esta carpeta.",notes_per_chunk:"Notas por archivo (Grupo)",notes_per_chunk_hint:"Define cu√°ntas notas se agrupar√°n en cada archivo.",save_changes:"Guardar Cambios",session_security:"Seguridad de la Sesi√≥n",logout:"Cerrar Sesi√≥n",logout_hint:"Cerrar la sesi√≥n actual eliminar√° la clave de acceso de la memoria.",encryption:"Encriptaci√≥n",algo:"Algoritmo preferido",update_algo:"Actualizar Algoritmo",reset_app:"Restablecer Aplicaci√≥n",reset_warning:"Esta acci√≥n borrar√° permanentemente todas las notas y categor√≠as almacenadas localmente.",reset_confirm_label:'Para confirmar, escribe "confirmar" a continuaci√≥n:',reset_btn:"Eliminar todos los datos locales",reset_keyword:"confirmar"},categories:{title:"Gestionar Categor√≠as",add_new:"Nueva Categor√≠a",name_placeholder:"Nombre de la categor√≠a",icon_label:"Icono",color_label:"Color",password_label:"Contrase√±a (Opcional)",password_hint:"Dejar vac√≠o para sin protecci√≥n",create:"Crear Categor√≠a",edit:"Editar Categor√≠a",delete:"Eliminar",save:"Guardar Categor√≠a",delete_confirm:"¬øEliminar esta categor√≠a? Las notas se mantendr√°n pero sin etiqueta.",no_category:"Sin categor√≠a"},common:{cancel:"Cancelar",confirm:"Confirmar",search:"Buscar",search_prompt:"Ingresa t√©rmino de b√∫squeda:",security_prompt:"Seguridad",security_desc_prompt:"Ingresa la contrase√±a para continuar",restricted_access:"Acceso Restringido",enter_cat_pass:"Ingresa la contrase√±a para",write_here:"Escribe aqu√≠..."},biometrics:{title:"Huella / Face ID",desc:"Usa biometr√≠a para desbloquear tu b√≥veda r√°pidamente",enabled:"Activado",disabled:"Desactivado",enable_btn:"Activar",disable_btn:"Desactivar",setup_prompt:"Ingresa tu contrase√±a maestra para activar la biometr√≠a",not_supported:"Tu dispositivo no soporta biometr√≠a",success_enable:"‚úÖ Biometr√≠a activada",success_disable:"üîì Biometr√≠a desactivada",fail_enable:"‚ùå Error al activar biometr√≠a",incorrect_pass:"‚ùå Contrase√±a incorrecta"}}};let Je="en";function Un(){const n=localStorage.getItem("cn_lang"),e=navigator.language.split("-")[0];Je=n||(e==="es"?"es":"en"),document.documentElement.lang=Je}function Vn(n){pn[n]&&(Je=n,localStorage.setItem("cn_lang",n),document.documentElement.lang=n,location.reload())}function m(n){const e=n.split(".");let o=pn[Je];for(const a of e)if(o=o==null?void 0:o[a],!o)break;return o||n}function gn(){const n=!!(sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3"));return`
    <div id="auth-shield" class="fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-sm transition-opacity duration-300 ${n?"opacity-0 pointer-events-none":""}" style="${n?"display: none":""}">
        <div class="w-full max-w-sm p-8 space-y-6 bg-card border rounded-lg shadow-lg">
            <div class="text-center space-y-2">
                <div class="mx-auto w-10 h-10 bg-primary rounded-md flex items-center justify-center text-primary-foreground">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </div>
                <h1 class="text-2xl font-semibold tracking-tight" id="auth-title">${m("auth.title")}</h1>
                <p class="text-sm text-muted-foreground" id="auth-desc">${m("auth.desc")}</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="master-password" placeholder="${m("auth.pass_placeholder")}" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="master-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                <div class="relative group hidden" id="confirm-password-wrapper">
                    <input type="password" id="confirm-password" placeholder="${m("auth.repeat_placeholder")}" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="confirm-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                
                <div class="flex items-center gap-2 py-1">
                    <input type="checkbox" id="auth-remember" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <label for="auth-remember" class="text-xs text-muted-foreground cursor-pointer select-none">${m("auth.remember_me")}</label>
                </div>

                <button id="auth-submit" class="btn-shad btn-shad-primary w-full h-11 font-bold">${m("auth.unlock")}</button>
                
                <button id="auth-biometric" class="hidden btn-shad btn-shad-secondary w-full h-11 font-bold flex items-center justify-center gap-2">
                     <i data-lucide="fingerprint" class="w-5 h-5"></i> <span id="bio-text">${m("auth.use_bio")}</span>
                </button>

                <div id="auth-extra-actions" class="hidden pt-4 border-t border-border/50">
                    <button id="auth-force-reload" class="flex items-center justify-center gap-2 w-full p-3 text-xs text-destructive bg-destructive/5 hover:bg-destructive/10 rounded-lg border border-destructive/10 transition-all font-medium">
                        <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> ${m("auth.problems")}
                    </button>
                </div>
            </div>
        </div>
    </div>`}async function mn(n){document.getElementById("auth-shield");const e=!localStorage.getItem("cn_master_hash_v3"),o=sessionStorage.getItem("cn_vault_key_v3"),a=localStorage.getItem("cn_vault_key_v3"),i=localStorage.getItem("cn_bio_enabled")==="true",r=localStorage.getItem("cn_remember_me_v3")==="true",s=document.getElementById("auth-biometric");window.PublicKeyCredential&&s&&(s.classList.remove("hidden"),i?document.getElementById("bio-text").innerText=m("auth.bio_unlock"):document.getElementById("bio-text").innerText=m("auth.bio_setup")),e?showSetupPage():o?De(o,n):a?i?setTimeout(()=>{fn(n).catch(()=>{console.log("Auto-bio failed/cancelled")})},500):r?De(a,n):showLoginPage():showLoginPage()}async function fn(n){if(localStorage.getItem("cn_bio_enabled")==="true")try{const o=new Uint8Array(32);window.crypto.getRandomValues(o),await navigator.credentials.get({publicKey:{challenge:o,rpId:window.location.hostname,userVerification:"required",timeout:6e4}});const a=localStorage.getItem("cn_vault_key_v3");a?De(a,n):(I("‚ùå Error: Llave no encontrada. Ingresa contrase√±a."),localStorage.setItem("cn_bio_enabled","false"))}catch(o){console.error(o),I(m("auth.bio_fail"))}else{const o=document.getElementById("master-password").value;if(!o)return I("‚ö†Ô∏è Ingresa tu contrase√±a primero para configurar");const a=await O.hash(o),i=localStorage.getItem("cn_master_hash_v3");if(a!==i)return I("‚ùå Contrase√±a incorrecta");if(!window.PublicKeyCredential)return I("‚ùå Tu dispositivo no soporta biometr√≠a");try{const r=new Uint8Array(32);window.crypto.getRandomValues(r),await navigator.credentials.create({publicKey:{challenge:r,rp:{name:m("app_name"),id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}}),localStorage.setItem("cn_bio_enabled","true");const s=await O.deriveVaultKey(o);localStorage.setItem("cn_vault_key_v3",s),I("‚úÖ Huella activada"),De(s,n)}catch(r){console.error(r),I("‚ùå Error al activar biometr√≠a: "+r.message)}}}async function De(n,e){const o=document.getElementById("auth-shield");o.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>o.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),sessionStorage.setItem("cn_vault_key_v3",n),await jn(n),e()}async function At(n){const e=document.getElementById("master-password").value,o=document.getElementById("confirm-password").value,a=!localStorage.getItem("cn_master_hash_v3");if(!e)return I("Ingresa una contrase√±a");if(a){if(!o)return I(m("auth.confirm_pass"));if(e!==o)return I(m("auth.password_mismatch"));if(e.length<4)return I(m("auth.password_short"))}const i=await O.hash(e),r=await O.deriveVaultKey(e),s=localStorage.getItem("cn_master_hash_v3"),l=document.getElementById("auth-remember").checked;if(!s)localStorage.setItem("cn_master_hash_v3",i),l&&(localStorage.setItem("cn_vault_key_v3",r),localStorage.setItem("cn_remember_me_v3","true")),De(r,n),I(m("auth.vault_created"));else if(s===i)l?(localStorage.setItem("cn_vault_key_v3",r),localStorage.setItem("cn_remember_me_v3","true")):!localStorage.getItem("cn_bio_enabled")==="true"&&(localStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_remember_me_v3")),De(r,n),I(m("auth.vault_opened"));else return I(m("auth.incorrect_pass"))}const Gn=Object.freeze(Object.defineProperty({__proto__:null,checkAuthStatus:mn,getAuthShieldTemplate:gn,handleBiometricAuth:fn,handleMasterAuth:At},Symbol.toStringTag,{value:"Module"}));function Wn(){return`
    <div id="app" class="flex h-screen overflow-hidden opacity-100 transition-opacity duration-300">
        <!-- Sidebar Desktop -->
        <aside class="w-64 hidden md:flex flex-col border-r bg-sidebar">
            <div class="p-6 flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 overflow-hidden" id="sidebar-logo-container">
                    <div class="w-10 h-10 rounded-xl bg-transparent flex items-center justify-center shrink-0">
                        <img src="./favicon.png" alt="Logo" class="w-full h-full object-contain">
                    </div>
                    <div class="sidebar-title-text transition-opacity duration-300">
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">${m("app_name")}</h1>
                    </div>
                </div>
                <button id="sidebar-collapse-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-all shrink-0" title="Contraer men√∫">
                    <i data-lucide="chevrons-left" class="w-4 h-4" id="sidebar-collapse-icon"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto px-4 space-y-8">
                <div class="space-y-1">
                    <button class="nav-link w-full" data-view="all">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> <span class="sidebar-label text-foreground/90 font-bold">${m("sidebar.all_notes")}</span>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between px-4" id="sidebar-categories-header">
                        <h3 class="sidebar-section-title text-[11px] font-bold text-muted-foreground uppercase tracking-wider">${m("sidebar.tags")}</h3>
                    </div>
                    <div id="sidebar-categories" class="space-y-1"></div>
                </div>
            </div>

            <div class="p-6 space-y-2 mt-auto">
                <button id="sidebar-manage-cats" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="tag" class="w-3.5 h-3.5"></i> <span class="sidebar-label">${m("sidebar.manage_tags")}</span>
                </button>
                <button id="settings-trigger" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="settings" class="w-3.5 h-3.5"></i> <span class="sidebar-label">${m("sidebar.settings")}</span>
                </button>
                <button id="sidebar-pwa-install-btn" class="hidden flex items-center gap-3 w-full px-4 py-3 rounded-lg text-sm font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-500/10 hover:bg-indigo-500/20 transition-all">
                    <i data-lucide="download" class="w-4 h-4"></i> <span class="sidebar-label">${m("sidebar.install_app")}</span>
                </button>
                <div class="mt-auto pt-4 border-t border-border/20 px-4">
                    <div id="app-version" class="text-[9px] text-muted-foreground font-mono opacity-50">v3.6.0</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-background relative overflow-hidden h-full">
            <!-- Desktop Header -->
            <header class="hidden md:flex h-16 items-center justify-between px-8 border-b shrink-0">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-sm">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="search-input" placeholder="${m("header.search_placeholder")}" class="pl-12 h-9 w-full" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sync-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-colors" title="${m("header.sync")}">
                        <i data-lucide="refresh-cw" class="w-5 h-5" id="sync-icon"></i>
                    </button>
                    <button id="pwa-install-btn" class="hidden btn-shad btn-shad-outline h-9 px-3">
                        <i data-lucide="download" class="w-4 h-4 mr-2"></i> ${m("header.install")}
                    </button>
                    <button id="add-note-btn" class="btn-shad btn-shad-primary h-9">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> ${m("header.new_note")}
                    </button>
                </div>
            </header>

            <!-- Mobile Top Bar Removed -->

            <!-- Grid -->
            <div id="notes-viewport" class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                <div class="max-w-7xl mx-auto space-y-8">
                    <div class="flex items-end justify-between">
                        <div>
                            <h1 id="view-title" class="text-3xl font-bold tracking-tight">${m("header.view_title_all")}</h1>
                        </div>
                    </div>
                    <div id="notes-grid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-background/95 backdrop-blur-2xl border-t flex items-center justify-around z-40 pb-safe">
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sidebar-trigger-bottom">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors nav-link-mobile" data-view="all">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
                <button class="flex items-center justify-center relative w-full h-full" id="mobile-add-btn">
                    <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 text-white rounded-full shadow-xl shadow-indigo-500/40 flex items-center justify-center transform -translate-y-5 hover:scale-105 active:scale-90 transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </div>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sync-btn-bottom">
                    <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-search-trigger">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
            </nav>
        </main>

        <!-- Mobile Sidebar Drawer -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-background/80 backdrop-blur-sm z-[100] hidden">
            <div id="mobile-sidebar-drawer" class="w-[80vw] h-full bg-card border-r flex flex-col animate-in slide-in-from-left duration-300">
                <div class="p-6 flex items-center justify-between border-b">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-transparent flex items-center justify-center shrink-0">
                            <img src="./favicon.png" alt="Logo" class="w-full h-full object-contain">
                        </div>
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">${m("app_name")}</h1>
                    </div>
                    <button id="close-mobile-sidebar" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-8">
                    <div class="space-y-1">
                        <button class="nav-link-mobile-drawer w-full" data-view="all">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i> ${m("sidebar.all_notes")}
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2" id="mobile-sidebar-categories-header">
                            <h3 class="sidebar-section-title">${m("sidebar.tags")}</h3>
                        </div>
                        <div id="mobile-sidebar-categories" class="space-y-1 px-2"></div>
                    </div>
                </div>
                <div class="p-6 border-t space-y-2">
                    <button id="mobile-pwa-install-btn" class="hidden flex items-center gap-3 w-full p-4 rounded-xl bg-gradient-to-r from-indigo-600 to-violet-600 text-white text-sm font-bold shadow-lg shadow-indigo-500/30">
                        <i data-lucide="download" class="w-5 h-5"></i> ${m("sidebar.install_app")}
                    </button>
                    <button id="mobile-manage-cats" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="tag" class="w-4 h-4"></i> ${m("sidebar.manage_tags")}
                    </button>
                    <button id="mobile-settings-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="settings" class="w-4 h-4"></i> ${m("sidebar.settings")}
                    </button>
                    <div class="pt-4 border-t space-y-3">
                        <div class="flex items-center justify-between px-3">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50">${m("sidebar.system")}</span>
                            <span id="mobile-app-version" class="text-[10px] font-bold font-mono px-2 py-0.5 rounded bg-primary/10 text-primary">v3.6.0</span>
                        </div>
                        <button id="mobile-force-reload-btn" class="flex items-center gap-3 w-full p-3 rounded-md bg-destructive/5 text-destructive text-sm font-medium border border-destructive/10">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> ${m("sidebar.force_reload")}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>`}let Lt=null,ue=null;function Kn(){return`
    <div id="editor-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-background/80 backdrop-blur-sm dialog-overlay"></div>
        <div class="dialog-content max-w-2xl h-[80vh] flex flex-col p-0">
            <div class="flex items-center gap-2 border-b pb-3 px-4 pt-4">
                <button id="close-editor" class="text-muted-foreground hover:text-foreground p-2 -ml-2" title="Volver">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <input type="text" id="edit-title" placeholder="T√≠tulo de la nota"
                    class="bg-transparent text-xl font-bold outline-none border-none placeholder:text-muted-foreground w-full">
                
                <div class="flex items-center gap-1">
                    <button id="note-expand-btn" class="editor-tool hidden md:inline-flex" title="Expandir">
                        <i data-lucide="maximize-2" class="w-5 h-5"></i>
                    </button>
                    <div class="relative">
                        <button id="note-options-btn" class="editor-tool" title="M√°s opciones">
                            <i data-lucide="more-vertical" class="w-5 h-5"></i>
                        </button>
                        <div id="note-options-menu" class="hidden absolute right-0 top-full mt-1 bg-popover border shadow-2xl rounded-xl p-1 z-[120] min-w-[170px]">
                            <button id="opt-copy-all" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="copy" class="w-4 h-4 text-muted-foreground"></i> Copiar todo
                            </button>
                            <button id="opt-download" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="download" class="w-4 h-4 text-muted-foreground"></i> Descargar .txt
                            </button>
                            <button id="opt-toggle-pin" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="pin" class="w-4 h-4 text-muted-foreground" id="opt-pin-icon"></i> <span id="opt-pin-label">Fijar nota</span>
                            </button>
                            <button id="opt-toggle-lock" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="lock" class="w-4 h-4 text-muted-foreground" id="opt-lock-icon"></i> <span id="opt-lock-label">Restringir</span>
                            </button>
                             <button id="opt-delete-note" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-destructive/5 text-destructive rounded-md transition-colors font-medium">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> Eliminar nota
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toolbar (Unified top) -->
            <div class="px-4 border-b py-2 flex items-center bg-muted/20">
                <div class="flex items-center gap-1.5 flex-1 min-w-0 overflow-x-auto no-scrollbar py-0.5">
                    <button data-cmd="bold" class="editor-tool border bg-background shrink-0"><i data-lucide="bold" class="w-4 h-4"></i></button>
                    <button data-cmd="italic" class="editor-tool border bg-background shrink-0"><i data-lucide="italic" class="w-4 h-4"></i></button>
                    <button data-cmd="underline" class="editor-tool border bg-background shrink-0"><i data-lucide="underline" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="checklist-btn" class="editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button id="mobile-checklist-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button data-cmd="insertUnorderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list" class="w-4 h-4"></i></button>
                    <button data-cmd="insertOrderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list-ordered" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="add-link" class="editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="mobile-link-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="open-text-colors" class="editor-tool border bg-background shrink-0 relative"><i data-lucide="type" class="w-4 h-4"></i><div class="w-3 h-[2px] bg-red-500 rounded-full absolute bottom-1 right-2"></div></button>
                    <button id="mobile-text-color-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="type" class="w-4 h-4"></i></button>
                    <button id="open-emojis" class="editor-tool hidden md:inline-flex border bg-background shrink-0"><i data-lucide="smile" class="w-4 h-4"></i></button>
                </div>
            </div>

            <div class="flex-1 py-4 overflow-y-auto px-4 relative">
                <div id="edit-content" contenteditable="true"
                    class="min-h-[300px] outline-none text-base leading-relaxed prose prose-slate dark:prose-invert max-w-none"
                    placeholder="Empieza a escribir..."></div>
            </div>

            <div class="border-t py-2 px-4 flex items-center justify-between gap-3 editor-bottom-bar shrink-0">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <button id="open-colors" class="editor-tool border border-input bg-background/50 transition-all shrink-0" title="Color de nota">
                        <i data-lucide="palette" class="w-4 h-4"></i>
                    </button>
                    <button id="open-colors-mobile" class="hidden editor-tool border border-input bg-background/50 shrink-0"><i data-lucide="palette" class="w-4 h-4"></i></button>

                    <div class="relative flex-1 min-w-0" id="cat-select-wrapper">
                        <button id="cat-dropdown-trigger"
                            class="h-9 w-full px-2 rounded-md border border-input bg-background/50 text-xs flex items-center justify-between gap-1 hover:bg-accent transition-all">
                            <i data-lucide="tag" id="selected-cat-icon" class="w-3.5 h-3.5 text-muted-foreground/60"></i>
                            <span id="selected-cat-label" class="truncate flex-1 text-left">Sin categor√≠a</span>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-muted-foreground shrink-0"></i>
                        </button>
                        <div id="cat-dropdown-menu"
                            class="absolute bottom-full mb-2 left-0 w-48 bg-popover border rounded-md shadow-xl hidden z-50 py-1 overflow-hidden">
                        </div>
                        <select id="edit-category" class="hidden">
                            <option value="">Sin categor√≠a</option>
                        </select>
                    </div>
                </div>

                <button id="save-note" class="hidden md:flex btn-shad btn-shad-primary h-9 px-6 font-bold">Hecho</button>
                <button id="save-note-mobile" class="md:hidden btn-shad btn-shad-primary h-9 px-4 font-bold">OK</button>
            </div>
            
         </div>
    </div>
    
    <!-- Popovers -->
    <div id="color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="bg-color-grid"></div>
    </div>
    <div id="text-color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="text-color-grid"></div>
    </div>
    <div id="emoji-popover" class="fixed z-[60] hidden popover-content w-80">
        <div class="grid grid-cols-8 gap-2 h-64 overflow-y-auto" id="emoji-grid"></div>
    </div>`}function Yn(n){const e=document.getElementById("editor-modal");document.getElementById("edit-title");const o=document.getElementById("edit-content"),a=document.getElementById("close-editor"),i=document.getElementById("save-note");a.onclick=()=>he();const r=async()=>{await he(),n()};i.onclick=r;const s=document.getElementById("save-note-mobile");s&&(s.onclick=r);const l=async()=>{p.editingNoteId&&confirm("¬øEliminar esta nota?")&&(p.notes=p.notes.filter(w=>w.id!==p.editingNoteId),await Z(),st(),n())};document.getElementById("opt-delete-note").onclick=l,document.querySelectorAll(".editor-tool[data-cmd]").forEach(w=>{w.dataset.cmd&&(w.onmousedown=T=>{T.preventDefault(),Se(),document.execCommand(w.dataset.cmd,!1,w.dataset.val||null),we()})}),Jn(),o.onkeyup=()=>{Ue(),we()},o.onmouseup=()=>{Ue(),we()},o.onfocus=()=>{Ue(),we()};const c=document.getElementById("edit-title");c.onfocus=()=>c.select(),c.onclick=()=>c.select();const d=document.getElementById("note-expand-btn");d.onclick=()=>{const w=e.querySelector(".dialog-content");w.classList.toggle("fullscreen");const T=w.classList.contains("fullscreen");d.innerHTML=`<i data-lucide="${T?"minimize-2":"maximize-2"}" class="w-5 h-5"></i>`,q()};const g=()=>{const w=document.getElementById("opt-toggle-pin").dataset.active==="true";Ht(!w),he(!1)};document.getElementById("opt-toggle-pin").onclick=w=>{w.stopPropagation(),g()};const u=async()=>{if(document.getElementById("opt-toggle-lock").dataset.active==="true")gt(!1),p.tempEditorPassword=null,he(!1);else{const T=await oe("Restringir Nota","Crea una contrase√±a para esta nota:");if(T){const j=document.getElementById("opt-toggle-lock");j.dataset.tempHash=await O.hash(T),gt(!0),he(!1)}}};document.getElementById("opt-toggle-lock").onclick=w=>{w.stopPropagation(),u()};const y=document.getElementById("mobile-checklist-btn");y&&(y.onclick=()=>x());const h=document.getElementById("mobile-link-btn");h&&(h.onclick=()=>B());const f=document.getElementById("mobile-text-color-btn");f&&(f.onclick=w=>{Se(),He(w,"text-color-popover")});const b=document.getElementById("note-options-btn"),_=document.getElementById("note-options-menu");b.onclick=w=>{w.stopPropagation(),_.classList.toggle("hidden")},document.getElementById("opt-copy-all").onclick=()=>{const w=document.getElementById("edit-content").innerText;navigator.clipboard.writeText(w).then(()=>{I("‚úÖ Contenido copiado"),_.classList.add("hidden")})},document.getElementById("opt-download").onclick=()=>{const w=document.getElementById("edit-title").value||"nota",T=document.getElementById("edit-content").innerText,j=new Blob([T],{type:"text/plain"}),P=URL.createObjectURL(j),R=document.createElement("a");R.href=P,R.download=`${w}.txt`,R.click(),_.classList.add("hidden")},document.addEventListener("click",()=>{_&&_.classList.add("hidden")});const B=async()=>{const w=await oe("Insertar Enlace","Ingresa la URL:");w&&(Se(),document.execCommand("createLink",!1,w.startsWith("http")?w:"https://"+w),o.querySelectorAll("a").forEach(j=>j.target="_blank"))};document.getElementById("add-link").onclick=B,document.getElementById("checklist-btn").onclick=()=>x();const x=()=>{var T;Se();const w=window.getSelection();if(w.rangeCount>0){const P=(T=w.getRangeAt(0).commonAncestorContainer.parentElement)==null?void 0:T.closest("li");P&&P.parentElement.classList.contains("checklist")?P.parentElement.classList.remove("checklist"):(document.execCommand("insertUnorderedList"),setTimeout(()=>{const R=window.getSelection();if(R.rangeCount>0){let F=R.focusNode;for(;F&&F.nodeName!=="UL"&&F!==o;)F=F.parentNode;F&&F.nodeName==="UL"&&(F.classList.add("checklist"),F.querySelectorAll("li").forEach(U=>{U.dataset.checked||(U.dataset.checked="false")}))}},10))}we()};o.onkeydown=w=>{w.key==="Tab"&&(w.preventDefault(),w.shiftKey?document.execCommand("outdent"):document.execCommand("indent"))},o.addEventListener("click",w=>{const T=w.target.closest(".checklist li");if(T){const j=T.getBoundingClientRect();w.clientX-j.left<35&&(w.preventDefault(),T.dataset.checked=T.dataset.checked==="true"?"false":"true",he(!1),we())}}),e.querySelector(".dialog-overlay").onclick=()=>{he()}}function we(){document.querySelectorAll(".editor-tool[data-cmd]").forEach(a=>{const i=a.dataset.cmd;try{const r=document.queryCommandState(i);a.classList.toggle("active",r)}catch{}});const n=document.getElementById("opt-toggle-pin");n&&Ht(n.dataset.active==="true");const e=document.getElementById("opt-toggle-lock");e&&gt(e.dataset.active==="true");const o=a=>{const i=document.getElementById(a);if(!i)return;let r=!1;try{const s=window.getSelection();if(s.rangeCount>0){let l=s.anchorNode;for(;l&&l.id!=="edit-content";){if(l.nodeName==="UL"&&l.classList.contains("checklist")){r=!0;break}l=l.parentNode}}}catch{}i.classList.toggle("active",r)};o("checklist-btn"),o("mobile-checklist-btn")}function qe(n=null){const e=document.getElementById("editor-modal"),o=document.getElementById("edit-title"),a=document.getElementById("edit-content"),i=document.getElementById("edit-category"),r=e.querySelector(".dialog-content");p.editingNoteId=n?n.id:null,o.value=(n==null?void 0:n.title)||"",a.innerHTML=(n==null?void 0:n.content)===void 0||(n==null?void 0:n.content)==="undefined"?"":(n==null?void 0:n.content)||"";let s="";!n&&p.currentView!=="all"&&(s=p.currentView),i.value=n?n.categoryId||"":s;const l=Xe.find(u=>u.id===(n?n.themeId:"default"))||Xe[0],c=p.settings.theme==="dark"?l.dark:l.light,d=l.id==="default"?p.settings.theme==="dark":dn(c);r.style.backgroundColor=c,r.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",r.dataset.themeId=l.id,o.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",a.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",e.querySelectorAll(".editor-tool:not(.active), #cat-dropdown-trigger").forEach(u=>{u.style.color=d?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.7)",u.style.borderColor=d?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",u.style.backgroundColor=d?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}),e.querySelectorAll(".editor-tool.active").forEach(u=>{u.style.backgroundColor="",u.style.color="",u.style.borderColor=""}),Ht(n?n.pinned:!1),gt(n?!!n.passwordHash:!1),Xn(),e.classList.remove("hidden"),a.focus(),ue={title:(n==null?void 0:n.title)||"",content:(n==null?void 0:n.content)===void 0||(n==null?void 0:n.content)==="undefined"?"":(n==null?void 0:n.content)||"",categoryId:n?n.categoryId||"":s,pinned:n?n.pinned:!1,themeId:l.id,passwordHash:n?n.passwordHash:null}}function st(){const n=document.getElementById("editor-modal"),e=n.querySelector(".dialog-content");e.classList.add("dialog-hide"),setTimeout(()=>{n.classList.add("hidden"),e.classList.remove("dialog-hide"),p.editingNoteId=null,p.tempEditorPassword=null;const o=document.getElementById("opt-toggle-lock");o&&(o.dataset.tempHash=""),document.getElementById("edit-title").value="",document.getElementById("edit-content").innerHTML="",window.refreshUI&&window.refreshUI()},200)}async function he(n=!0){const e=document.getElementById("edit-title"),o=document.getElementById("edit-content"),a=document.getElementById("edit-category"),i=document.querySelector("#editor-modal .dialog-content");if(!e||!o)return;let r=e.value.trim();const s=o.innerHTML,l=a?a.value:"",c=i?i.dataset.themeId:"default";if(!r&&(!s||s.trim()===""||s==="<br>")){if(p.editingNoteId){const x=p.notes.findIndex(w=>w.id===p.editingNoteId);x>=0&&(p.notes.splice(x,1),await Z(),window.refreshUI&&window.refreshUI(),window.triggerAutoSync&&window.triggerAutoSync())}n&&st();return}if(!r){const x=new Date;r=x.getFullYear()+"-"+String(x.getMonth()+1).padStart(2,"0")+"-"+String(x.getDate()).padStart(2,"0")+", "+String(x.getHours()).padStart(2,"0")+":"+String(x.getMinutes()).padStart(2,"0")}const g=p.notes.findIndex(x=>x.id===p.editingNoteId),u=document.getElementById("opt-toggle-pin"),y=document.getElementById("opt-toggle-lock"),h=u?u.dataset.active==="true":!1,f=y?y.dataset.active==="true":!1,b=y&&y.dataset.tempHash||"",_=f?b||(g>=0?p.notes[g].passwordHash:null):null;if(ue&&p.editingNoteId&&r===ue.title&&s===ue.content&&l===ue.categoryId&&h===ue.pinned&&c===ue.themeId&&_===ue.passwordHash&&n){st();return}const B={id:p.editingNoteId||Date.now().toString(),title:r,content:s,categoryId:l||null,pinned:h,themeId:c||"default",passwordHash:_,updatedAt:Date.now()};if(f&&!B.passwordHash){const x=await oe("Seguridad","Establece una contrase√±a para esta nota:");if(x)B.passwordHash=await O.hash(x);else return}g>=0?p.notes[g]=B:p.notes.unshift(B),p.editingNoteId||(p.editingNoteId=B.id),await Z(),n&&st(),window.refreshUI&&window.refreshUI(),setTimeout(()=>{window.triggerAutoSync&&window.triggerAutoSync()},50)}function Ue(){const n=window.getSelection();n.rangeCount>0&&(Lt=n.getRangeAt(0))}function Se(){if(Lt){const n=window.getSelection();n.removeAllRanges(),n.addRange(Lt)}}function Xn(){const n=document.getElementById("edit-category").value,e=p.categories.find(o=>o.id===n);document.getElementById("selected-cat-label")&&(document.getElementById("selected-cat-label").innerText=e?e.name:"Sin categor√≠a"),document.getElementById("selected-cat-icon")&&(document.getElementById("selected-cat-icon").setAttribute("data-lucide",e&&e.icon||"tag"),q())}function Ht(n){const e=document.getElementById("opt-toggle-pin");if(!e)return;e.dataset.active=n.toString();const o=document.getElementById("opt-pin-label"),a=document.getElementById("opt-pin-icon");o&&(o.innerText=n?"Desfijar nota":"Fijar nota"),a&&a.setAttribute("class",n?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground"),e.classList.toggle("menu-active-violet",n)}function gt(n){const e=document.getElementById("opt-toggle-lock");if(!e)return;e.dataset.active=n.toString();const o=document.getElementById("opt-lock-label"),a=document.getElementById("opt-lock-icon");o&&(o.innerText=n?"Quitar restricci√≥n":"Restringir"),a&&(a.setAttribute("data-lucide",n?"lock":"lock-open"),a.setAttribute("class",n?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground")),e.classList.toggle("menu-active-violet",n),q()}function Jn(){document.getElementById("open-colors").onclick=l=>He(l,"color-popover");const n=document.getElementById("open-colors-mobile");n&&(n.onclick=l=>He(l,"color-popover")),document.getElementById("open-text-colors").onmousedown=l=>{l.preventDefault(),Ue()},document.getElementById("open-text-colors").onclick=l=>He(l,"text-color-popover");const e=l=>{l.preventDefault(),Ue(),He(l,"emoji-popover")};document.getElementById("open-emojis").onmousedown=l=>l.preventDefault(),document.getElementById("open-emojis").onclick=e;const o=document.getElementById("mobile-open-emojis");o&&(o.onmousedown=l=>l.preventDefault(),o.onclick=e);const a=document.getElementById("bg-color-grid");Xe.forEach(l=>{const c=document.createElement("div");c.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",c.style.backgroundColor=p.settings.theme==="dark"?l.dark:l.light,c.onclick=()=>{const d=document.querySelector("#editor-modal .dialog-content");d.style.backgroundColor=p.settings.theme==="dark"?l.dark:l.light,d.dataset.themeId=l.id,je()},a.appendChild(c)});const i=document.getElementById("text-color-grid");Fn.forEach(l=>{const c=document.createElement("div");c.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",c.style.backgroundColor=l,c.onmousedown=d=>d.preventDefault(),c.onclick=()=>{Se(),document.execCommand("foreColor",!1,l),je()},i.appendChild(c)});const r=document.getElementById("emoji-grid");zn.forEach(l=>{const c=document.createElement("span");c.className="cursor-pointer hover:bg-accent p-2 rounded text-xl text-center",c.innerText=l,c.onclick=()=>{Se(),document.execCommand("insertHTML",!1,l),je()},r.appendChild(c)}),document.addEventListener("click",l=>{!l.target.closest(".editor-tool")&&!l.target.closest(".popover-content")&&!l.target.closest("#cat-dropdown-trigger")&&je()});const s=document.getElementById("cat-dropdown-trigger");s.onclick=l=>{l.stopPropagation(),document.getElementById("cat-dropdown-menu").classList.toggle("hidden")}}function He(n,e){n.stopPropagation();const o=document.getElementById(e),a=n.currentTarget.getBoundingClientRect();je(e),o.classList.remove("hidden"),window.innerHeight-a.bottom<250?(o.style.top="auto",o.style.bottom=`${window.innerHeight-a.top+8}px`):(o.style.top=`${a.bottom+8}px`,o.style.bottom="auto"),o.style.left=`${Math.min(a.left,window.innerWidth-o.offsetWidth-20)}px`,a.left+300>window.innerWidth&&(o.style.left="auto",o.style.right="20px")}function je(n=null){["color-popover","text-color-popover","emoji-popover","cat-dropdown-menu"].forEach(e=>{const o=document.getElementById(e);e!==n&&o&&o.classList.add("hidden")})}function Zn(){return`
    <div id="categories-modal" class="fixed inset-0 z-[70] hidden">
        <div class="dialog-overlay close-categories"></div>
        <div class="dialog-content w-full h-full md:max-w-none md:h-full md:rounded-none rounded-none flex flex-col shadow-2xl p-0 overflow-hidden">
            <div class="p-6 md:p-10 flex justify-between items-center border-b bg-background/50 backdrop-blur-md sticky top-0 z-10">
                <div>
                    <h2 class="text-2xl md:text-4xl font-bold text-foreground">${m("categories.title")}</h2>
                    <p class="text-xs md:text-base text-muted-foreground">${m("categories.name_placeholder")}</p>
                </div>
                <button class="close-categories p-3 hover:bg-accent rounded-full transition-colors"><i data-lucide="x" class="w-8 h-8"></i></button>
            </div>

            <div class="p-4 md:p-10 bg-muted/20 border-b">
                <div class="flex items-center gap-4 max-w-3xl mx-auto w-full">
                    <div class="relative flex-1">
                        <i data-lucide="tag" class="absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-foreground/50"></i>
                        <input type="text" id="new-cat-name" placeholder="${m("categories.add_new")}..." 
                               class="pl-14 h-14 md:h-16 w-full bg-background border-none ring-1 ring-border focus:ring-2 focus:ring-violet-500 rounded-2xl transition-all text-lg" autocomplete="off">
                    </div>
                    <button id="add-cat-btn" class="w-14 h-14 md:w-16 md:h-16 bg-violet-600 hover:bg-violet-700 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-violet-500/20 active:scale-95 transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 md:p-10 space-y-4 max-w-3xl mx-auto w-full" id="cat-manager-list">
                <!-- Items injected here -->
            </div>
            
            <div class="p-6 border-t bg-background/50 backdrop-blur-md sticky bottom-0">
                <button class="close-categories w-full md:max-w-xs mx-auto block h-14 bg-secondary text-secondary-foreground font-bold rounded-2xl hover:bg-secondary/80 transition-all text-lg underline">Cerrar</button>
            </div>
        </div>
        <div id="cat-icon-picker" class="fixed z-[80] hidden popover-content p-4 w-72 max-h-80 overflow-y-auto bg-popover border shadow-2xl rounded-3xl backdrop-blur-3xl">
            <div class="grid grid-cols-5 gap-3 p-1" id="cat-icons-grid"></div>
        </div>
    </div>`}function Ze(n,e=null){const o=document.getElementById("cat-manager-list");o&&(o.innerHTML="",e&&(p.categories=e),p.categories.forEach(a=>{const i=document.createElement("div");i.className="flex items-center gap-3 p-2 rounded-lg border bg-card/50 hover:bg-accent/30 transition-all group",i.innerHTML=`
            <div class="w-12 h-12 rounded-xl cursor-pointer hover:bg-accent border bg-background flex items-center justify-center shrink-0 transition-all active:scale-95" 
                 id="icon-trigger-${a.id}" title="Cambiar icono">
                 <i data-lucide="${a.icon||"tag"}" class="w-5 h-5 text-foreground/80"></i>
            </div>
            
            <div class="flex flex-col flex-1 min-w-0">
                <input type="text" value="${a.name}" 
                       class="bg-transparent border-none outline-none font-bold text-base w-full focus:ring-0 transition-colors h-7 px-0 rounded"
                       id="cn-${a.id}" autocomplete="off">
                <span class="text-[10px] text-muted-foreground uppercase tracking-widest font-medium">${a.passwordHash?"Restringida":"P√∫blica"}</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-violet-500/10 transition-all ${a.passwordHash?"text-violet-500 bg-violet-500/5 border border-violet-500/20":"text-muted-foreground border border-transparent"}"
                        id="lock-${a.id}" title="${a.passwordHash?"Restringido":"Restricci√≥n"}">
                    <i data-lucide="${a.passwordHash?"lock":"unlock"}" class="w-4 h-4"></i>
                </button>
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-destructive/10 hover:text-destructive text-muted-foreground border border-transparent transition-all"
                        id="del-${a.id}" title="Eliminar">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `,o.appendChild(i),document.getElementById(`icon-trigger-${a.id}`).onclick=s=>{s.stopPropagation(),Qn(a.id,n,s.currentTarget)};const r=document.getElementById(`cn-${a.id}`);r.oninput=s=>{a.name=s.target.value,n()},r.onchange=async()=>{await Z(),n(),window.triggerAutoSync&&window.triggerAutoSync()},document.getElementById(`lock-${a.id}`).onclick=()=>to(a.id,n),document.getElementById(`del-${a.id}`).onclick=()=>eo(a.id,n)}),q())}async function Qn(n,e,o){const a=p.categories.find(c=>c.id===n);if(!a)return;const i=document.getElementById("cat-icon-picker"),r=document.getElementById("cat-icons-grid");r.innerHTML="",qn.forEach(c=>{const d=document.createElement("button");d.className="w-9 h-9 flex items-center justify-center rounded-md hover:bg-primary/10 hover:text-primary transition-all text-muted-foreground",d.innerHTML=`<i data-lucide="${c}" class="w-5 h-5"></i>`,d.onclick=async()=>{a.icon=c,await Z(),Ze(e),e(),i.classList.add("hidden"),window.triggerAutoSync&&window.triggerAutoSync()},r.appendChild(d)}),q();const s=o.getBoundingClientRect();i.style.top=`${s.bottom+8}px`,i.style.left=`${s.left}px`,i.classList.remove("hidden");const l=c=>{!i.contains(c.target)&&!o.contains(c.target)&&(i.classList.add("hidden"),document.removeEventListener("click",l))};setTimeout(()=>document.addEventListener("click",l),10)}async function eo(n,e){const o=p.categories.find(a=>a.id===n);if(o){if(o.passwordHash){const a=await oe("Seguridad","Etiqueta restringida. Ingresa contrase√±a para eliminar:");if(!a)return;if(await O.hash(a)!==o.passwordHash)return I("‚ùå Error: Contrase√±a incorrecta")}confirm(`¬øEliminar la etiqueta "${o.name}"? Las notas no se borrar√°n.`)&&(p.categories=p.categories.filter(a=>a.id!==n),p.notes.forEach(a=>{a.categoryId===n&&(a.categoryId=null)}),p.currentView===n&&(p.currentView="all"),await Z(),Ze(e),e(),window.triggerAutoSync&&window.triggerAutoSync())}}async function to(n,e){const o=p.categories.find(a=>a.id===n);if(o){if(o.passwordHash){const a=await oe("Seguridad","Ingresa la contrase√±a para quitar la restricci√≥n:");if(!a)return;if(await O.hash(a)!==o.passwordHash)return I("‚ùå Error: Contrase√±a incorrecta");o.passwordHash=null,I("üîì Restricci√≥n quitada")}else{const a=await oe("Seguridad","Define una contrase√±a para restringir esta etiqueta:");a&&(o.passwordHash=await O.hash(a),I("üîí Etiqueta restringida"))}await Z(),Ze(e),e(),window.triggerAutoSync&&window.triggerAutoSync()}}function no(){return`
    <div id="settings-modal" class="fixed inset-0 z-[80] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content w-full h-full md:w-auto md:max-w-2xl md:h-[500px] p-0 overflow-hidden flex flex-col md:flex-row rounded-none md:rounded-xl">
            <!-- Sidebar Settings -->
            <div id="settings-sidebar" class="w-full md:w-48 bg-muted/50 border-b md:border-b-0 md:border-r p-4 flex flex-col gap-2 overflow-y-auto">
                <div class="flex items-center justify-between mb-4 md:hidden">
                    <h3 class="font-bold text-2xl">${m("settings.title")}</h3>
                    <button class="close-settings p-2 hover:bg-accent rounded-full">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2 active-highlight" data-tab="appearance">
                    <i data-lucide="palette" class="w-6 h-6 md:w-5 md:h-5"></i> ${m("settings.general")}
                </button>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="sync">
                    <i data-lucide="refresh-cw" class="w-6 h-6 md:w-5 md:h-5"></i> ${m("settings.sync")}
                </button>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="security">
                    <i data-lucide="shield" class="w-6 h-6 md:w-5 md:h-5"></i> ${m("settings.security")}
                </button>
                <button class="settings-tab text-destructive mt-auto py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="danger">
                    <i data-lucide="alert-triangle" class="w-6 h-6 md:w-5 md:h-5"></i> ${m("settings.danger")}
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col min-w-0" id="settings-content-area">
                <div class="p-6 md:p-4 border-b flex items-center gap-3">
                    <button class="md:hidden p-3 hover:bg-accent rounded-xl group" id="settings-back-btn">
                        <i data-lucide="arrow-left" class="w-6 h-6 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                    <h2 id="settings-tab-title" class="font-bold text-xl md:text-base flex-1">${m("settings.title")}</h2>
                    <button class="close-settings p-3 md:p-2 hover:bg-accent rounded-xl group">
                        <i data-lucide="x" class="w-6 h-6 md:w-5 md:h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6" id="settings-panels">
                    <!-- Panel: Apariencia -->
                    <div id="panel-appearance" class="settings-panel space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("settings.lang")}</h3>
                            <div class="space-y-2">
                                <select id="language-select" class="h-12 md:h-10 w-full px-4 rounded-xl border bg-background text-lg md:text-sm">
                                    <option value="en">üá∫üá∏ English</option>
                                    <option value="es">üá™üá∏ Espa√±ol</option>
                                    <option value="fr">üá´üá∑ Fran√ßais</option>
                                    <option value="de">üá©üá™ Deutsch</option>
                                    <option value="it">üáÆüáπ Italiano</option>
                                    <option value="pt">üáµüáπ Portugu√™s</option>
                                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                    <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                                    <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                                    <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                                    <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                    <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                                </select>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("settings.theme")}</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button id="theme-light" class="flex flex-col items-center gap-3 p-6 rounded-2xl border bg-card hover:bg-accent transition-all group">
                                    <div class="w-full aspect-video bg-zinc-100 rounded-xl border flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-300 rounded"></div>
                                    </div>
                                    <span class="text-sm font-medium">${m("settings.light")}</span>
                                </button>
                                <button id="theme-dark" class="flex flex-col items-center gap-3 p-6 rounded-2xl border bg-zinc-950 hover:bg-zinc-900 transition-all group ring-primary">
                                    <div class="w-full aspect-video bg-zinc-800 rounded-xl border border-zinc-700 flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-600 rounded"></div>
                                    </div>
                                    <span class="text-sm font-medium text-white">${m("settings.dark")}</span>
                                </button>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("settings.maintenance")}</h3>
                            <div class="p-6 rounded-2xl border bg-primary/5 space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium">${m("settings.installed_version")}</span>
                                    <span class="text-sm font-bold font-mono text-primary" id="settings-version-display">v3.6.0</span>
                                </div>
                                <button id="force-reload-btn-settings" class="btn-shad btn-shad-outline w-full h-12 flex items-center justify-center gap-2 group text-base rounded-xl">
                                    <i data-lucide="refresh-cw" class="w-5 h-5 group-hover:rotate-180 transition-transform duration-500"></i>
                                    ${m("sidebar.force_reload")}
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Panel: Sincronizaci√≥n -->
                    <div id="panel-sync" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Google Drive</h3>
                                <div id="drive-status" class="text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground font-bold uppercase">${m("settings.sync_status.disconnected")}</div>
                            </div>
                            
                            <button id="connect-drive-btn" class="btn-shad btn-shad-outline w-full h-12 flex items-center justify-center gap-2 text-base rounded-xl">
                                <i data-lucide="link" class="w-5 h-5"></i> ${m("settings.connect_drive")}
                            </button>

                            <div class="space-y-3 pt-4 border-t border-dashed">
                                <label class="text-sm font-medium">${m("settings.drive_folder")}</label>
                                <input type="text" id="config-drive-path" class="h-12 px-5 w-full rounded-xl" placeholder="p.ej. CloudNotesV3" autocomplete="off">
                                <p class="text-xs text-muted-foreground">${m("settings.drive_folder_hint")}</p>
                            </div>
                            <div class="space-y-3">
                                <label class="text-sm font-medium">${m("settings.notes_per_chunk")}</label>
                                <div class="flex items-center gap-3">
                                    <input type="number" id="config-notes-per-chunk" class="h-12 px-5 w-full rounded-xl" placeholder="50" min="10" max="500">
                                    <span class="text-xs text-muted-foreground shrink-0 font-bold uppercase">Notas</span>
                                </div>
                            </div>
                            <button id="save-sync-config" class="btn-shad btn-shad-primary w-full h-14 text-lg font-bold rounded-2xl shadow-lg shadow-primary/20 transition-all active:scale-95">${m("settings.save_changes")}</button>
                        </section>
                    </div>

                    <!-- Panel: Seguridad -->
                    <div id="panel-security" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("biometrics.title")}</h3>
                            <div class="p-6 rounded-2xl border space-y-4" id="bio-settings-container">
                                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                                    <div class="flex-1">
                                        <p class="text-lg font-bold md:text-base">${m("biometrics.title")}</p>
                                        <p class="text-sm text-muted-foreground mt-1">${m("biometrics.desc")}</p>
                                        <div class="mt-3 flex items-center gap-2">
                                            <div id="bio-status-badge" class="text-xs px-3 py-1.5 rounded-full bg-muted text-muted-foreground font-bold uppercase tracking-wider">
                                                ${m("biometrics.disabled")}
                                            </div>
                                        </div>
                                    </div>
                                    <button id="toggle-biometric-btn" class="btn-shad btn-shad-primary w-full md:w-auto h-14 md:h-11 px-8 flex items-center justify-center gap-3 shrink-0 rounded-2xl md:rounded-xl text-lg md:text-sm font-bold shadow-lg shadow-primary/20 active:scale-95">
                                        <i data-lucide="fingerprint" class="w-6 h-6 md:w-5 md:h-5"></i>
                                        <span id="bio-toggle-text">${m("biometrics.enable_btn")}</span>
                                    </button>
                                </div>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("settings.session_security")}</h3>
                            <div class="p-6 rounded-2xl border bg-muted/20 space-y-4">
                                <p class="text-sm text-muted-foreground">${m("settings.logout_hint")}</p>
                                <button id="logout-btn" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white w-full h-14 md:h-12 flex items-center justify-center gap-3 transition-all rounded-2xl text-lg font-bold">
                                    <i data-lucide="log-out" class="w-6 h-6 md:w-5 md:h-5"></i> ${m("settings.logout")}
                                </button>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${m("settings.encryption")}</h3>
                            <div class="space-y-3">
                                <label class="text-sm font-medium">${m("settings.algo")}</label>
                                <select id="config-algo" class="h-12 md:h-10 w-full px-4 rounded-xl">
                                    <option value="aes-256-gcm">AES-256-GCM (Recommended)</option>
                                    <option value="kyber">CRYSTALS-Kyber (Experimental)</option>
                                </select>
                            </div>
                             <button id="save-security-config" class="btn-shad btn-shad-primary w-full h-14 font-bold rounded-2xl text-lg shadow-lg shadow-primary/20 transition-all active:scale-95">${m("settings.update_algo")}</button>
                        </section>
                    </div>

                    <!-- Panel: Danger Zone -->
                    <div id="panel-danger" class="settings-panel hidden space-y-6">
                        <section class="p-4 rounded-lg border border-destructive/20 bg-destructive/5 space-y-4">
                            <h3 class="text-sm font-semibold text-destructive uppercase tracking-wider">${m("settings.reset_app")}</h3>
                            <p class="text-xs text-muted-foreground underline">${m("settings.reset_warning")}</p>
                            <div class="space-y-2">
                                <label class="text-[10px] uppercase font-bold text-destructive/70">${m("settings.reset_confirm_label")}</label>
                                <input type="text" id="factory-reset-confirm" class="h-10 px-4 mt-1 w-full border rounded-md" placeholder="${m("settings.reset_keyword")}" autocomplete="off">
                            </div>
                            <button id="factory-reset" class="btn-shad bg-destructive text-destructive-foreground hover:bg-destructive/90 w-full h-10 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> ${m("settings.reset_btn")}
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function oo(){const n=document.querySelectorAll(".settings-panel"),e=document.querySelectorAll(".settings-tab"),o=document.getElementById("settings-tab-title"),a=document.getElementById("settings-sidebar"),i=a.nextElementSibling,r=document.getElementById("settings-back-btn"),s=f=>{e.forEach(_=>_.classList.toggle("active",_.dataset.tab===f)),n.forEach(_=>_.classList.toggle("hidden",_.id!==`panel-${f}`));const b={appearance:m("settings.general"),sync:m("settings.sync"),security:m("settings.security"),danger:m("settings.danger")};o.innerText=b[f]||m("settings.title"),window.innerWidth<768&&(a.classList.add("hidden"),i.classList.remove("hidden"),r.classList.remove("hidden")),q()};e.forEach(f=>{f.onclick=()=>s(f.dataset.tab)}),r.onclick=()=>{a.classList.remove("hidden"),i.classList.add("hidden"),r.classList.add("hidden"),o.innerText="Configuraci√≥n"},window.innerWidth<768?(i.classList.add("hidden"),r.classList.add("hidden"),e.forEach(f=>f.classList.remove("active"))):s("appearance");const l=document.getElementById("force-reload-btn"),c=document.getElementById("force-reload-btn-settings");l&&(l.onclick=Nt),c&&(c.onclick=Nt);const d=document.getElementById("language-select");d&&(d.value=Je,d.onchange=f=>Vn(f.target.value));const g=document.getElementById("toggle-biometric-btn"),u=document.getElementById("bio-status-badge"),y=document.getElementById("bio-toggle-text"),h=document.getElementById("bio-settings-container");if(g){const f=()=>{localStorage.getItem("cn_bio_enabled")==="true"?(u.textContent=m("biometrics.enabled"),u.classList.remove("bg-muted","text-muted-foreground"),u.classList.add("bg-primary/20","text-primary"),y.textContent=m("biometrics.disable_btn"),g.classList.remove("btn-shad-primary"),g.classList.add("btn-shad-outline"),h.classList.add("bg-primary/5")):(u.textContent=m("biometrics.disabled"),u.classList.remove("bg-primary/20","text-primary"),u.classList.add("bg-muted","text-muted-foreground"),y.textContent=m("biometrics.enable_btn"),g.classList.remove("btn-shad-outline"),g.classList.add("btn-shad-primary"),h.classList.remove("bg-primary/5")),q()};f(),g.onclick=async()=>{if(localStorage.getItem("cn_bio_enabled")==="true"){localStorage.setItem("cn_bio_enabled","false"),f();const{showToast:_}=await rt(async()=>{const{showToast:B}=await Promise.resolve().then(()=>Wt);return{showToast:B}},void 0);_(m("biometrics.success_disable"))}else{const{showToast:_,openPrompt:B}=await rt(async()=>{const{showToast:x,openPrompt:w}=await Promise.resolve().then(()=>Wt);return{showToast:x,openPrompt:w}},void 0);if(!window.PublicKeyCredential)return _(m("biometrics.not_supported"));try{const x=await B(m("biometrics.setup_prompt"),!0);if(!x||x.biometric)return;const{SecurityService:w}=await rt(async()=>{const{SecurityService:F}=await Promise.resolve().then(()=>Hn);return{SecurityService:F}},void 0),T=await w.hash(x),j=localStorage.getItem("cn_master_hash_v3");if(T!==j)return _(m("biometrics.incorrect_pass"));const P=new Uint8Array(32);window.crypto.getRandomValues(P),await navigator.credentials.create({publicKey:{challenge:P,rp:{name:m("app_name"),id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}});const R=await w.deriveVaultKey(x);localStorage.setItem("cn_vault_key_v3",R),localStorage.setItem("cn_bio_enabled","true"),f(),_(m("biometrics.success_enable"))}catch(x){console.error(x),_(m("biometrics.fail_enable")+": "+x.message)}}}}}async function Nt(){if(confirm("Esto reiniciar√° la aplicaci√≥n, limpiar√° la cach√© y eliminar√° el Service Worker para forzar la √∫ltima versi√≥n. ¬øContinuar?"))try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const o of e)await o.unregister()}if("caches"in window){const e=await caches.keys();for(const o of e)await caches.delete(o)}sessionStorage.clear();const n=new URL(window.location.href);n.searchParams.set("t",Date.now()),window.location.href=n.toString()}catch(n){console.error("Error clearing cache:",n),window.location.reload()}}function ao(){return`
    <!-- Prompt Modal -->
    <div id="prompt-modal" class="fixed inset-0 z-[250] hidden flex items-start justify-center pt-24 md:pt-0 md:items-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="relative w-full max-w-[340px] bg-card border shadow-2xl rounded-2xl p-6 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="space-y-2">
                <h2 id="prompt-title" class="text-xl font-bold tracking-tight">Seguridad</h2>
                <p id="prompt-desc" class="text-sm text-muted-foreground leading-relaxed">Ingresa la contrase√±a para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="prompt-input" placeholder="Tu contrase√±a"
                        class="h-12 w-full text-center tracking-widest outline-none pr-12 bg-muted/50 border border-border focus:border-indigo-500/50 transition-all rounded-xl">
                    <button type="button"
                        class="absolute right-0 top-0 h-12 w-12 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass"
                        data-target="prompt-input">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-3 pt-2">
                    <button id="prompt-cancel" class="h-11 px-4 rounded-xl border bg-background hover:bg-accent text-sm font-medium flex-1">Cancelar</button>
                    <button id="prompt-confirm" class="h-11 px-4 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold flex-1 shadow-lg shadow-indigo-500/20">Confirmar</button>
                </div>
                <button id="prompt-biometric" class="hidden w-full h-11 rounded-xl bg-secondary/50 hover:bg-secondary text-secondary-foreground text-sm font-bold flex items-center justify-center gap-2 transition-all">
                    <i data-lucide="fingerprint" class="w-5 h-5"></i> Usar Huella
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <div class="border">
            ¬°Acci√≥n completada!
        </div>
    </div>`}function jt(n,e=null){const o=document.getElementById("sidebar-categories"),a=document.getElementById("mobile-sidebar-categories"),i=document.getElementById("edit-category"),r=document.getElementById("cat-dropdown-menu");e&&(p.categories=e),o&&(o.innerHTML=""),a&&(a.innerHTML=""),i&&(i.innerHTML=`<option value="">${t("categories.no_category")}</option>`),r&&(r.innerHTML=`<div class="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer border-b" data-id="">${t("categories.no_category")}</div>`);const s=p.categories.length>0,l=document.getElementById("sidebar-categories-header"),c=document.getElementById("mobile-sidebar-categories-header");l&&l.classList.toggle("hidden",!s),c&&c.classList.toggle("hidden",!s),document.querySelectorAll('.nav-link[data-view="all"], .nav-link-mobile[data-view="all"], .nav-link-mobile-drawer[data-view="all"]').forEach(u=>{u.classList.toggle("active",p.currentView==="all")});const d=(u,y,h)=>{if(!r)return;const f=document.createElement("div");f.className="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer flex items-center gap-2",f.innerHTML=`<i data-lucide="${h||"tag"}" class="w-3.5 h-3.5 text-foreground/70"></i> ${y}`,f.onclick=()=>{i&&(i.value=u),g(),r.classList.add("hidden")},r.appendChild(f)},g=()=>{const u=document.getElementById("edit-category").value,y=p.categories.find(h=>h.id===u);document.getElementById("selected-cat-label").innerText=y?y.name:t("categories.no_category")};if(r){const u=r.querySelector('[data-id=""]');u&&(u.onclick=()=>{i&&(i.value=""),g(),r.classList.add("hidden")})}p.categories.forEach(u=>{const y=(h=!1)=>{const f=document.createElement("button");return f.className=h?"nav-link-mobile-drawer w-full group":"nav-link w-full group",f.setAttribute("data-view",u.id),p.currentView===u.id&&f.classList.add("active"),f.onclick=async()=>{if(u.passwordHash){const b=await oe(t("common.restricted_access"),`${t("common.enter_cat_pass")} "${u.name}":`);if(!b)return;if(!(typeof b=="object"&&b.biometric)){if(await O.hash(b)!==u.passwordHash){I(t("auth.incorrect_pass"));return}}}if(n(u.id,u.name),h){const b=document.getElementById("mobile-sidebar-overlay");b&&b.classList.add("hidden")}},f.innerHTML=`
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center gap-3">
                        <i data-lucide="${u.icon||"tag"}" class="w-4 h-4 text-foreground/70 group-hover:text-violet-500 transition-colors"></i>
                        <span class="truncate sidebar-label">${u.name}</span>
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        ${u.passwordHash?'<i data-lucide="lock" class="w-3 h-3 text-muted-foreground"></i>':""}
                    </div>
                </div>
            `,f};if(o&&o.appendChild(y(!1)),a&&a.appendChild(y(!0)),i){const h=document.createElement("option");h.value=u.id,h.innerText=u.name,i.appendChild(h)}d(u.id,u.name,u.icon)}),q()}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Kt(n,e){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),o.push.apply(o,a)}return o}function ae(n){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?arguments[e]:{};e%2?Kt(Object(o),!0).forEach(function(a){io(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Kt(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function lt(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?lt=function(e){return typeof e}:lt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(n)}function io(n,e,o){return e in n?Object.defineProperty(n,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[e]=o,n}function se(){return se=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},se.apply(this,arguments)}function ro(n,e){if(n==null)return{};var o={},a=Object.keys(n),i,r;for(r=0;r<a.length;r++)i=a[r],!(e.indexOf(i)>=0)&&(o[i]=n[i]);return o}function so(n,e){if(n==null)return{};var o=ro(n,e),a,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)a=r[i],!(e.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(n,a)&&(o[a]=n[a])}return o}var lo="1.15.6";function re(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var le=re(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Qe=re(/Edge/i),Yt=re(/firefox/i),Ve=re(/safari/i)&&!re(/chrome/i)&&!re(/android/i),Rt=re(/iP(ad|od|hone)/i),hn=re(/chrome/i)&&re(/android/i),bn={capture:!1,passive:!1};function D(n,e,o){n.addEventListener(e,o,!le&&bn)}function C(n,e,o){n.removeEventListener(e,o,!le&&bn)}function mt(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function vn(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function ee(n,e,o,a){if(n){o=o||document;do{if(e!=null&&(e[0]===">"?n.parentNode===o&&mt(n,e):mt(n,e))||a&&n===o)return n;if(n===o)break}while(n=vn(n))}return null}var Xt=/\s+/g;function Y(n,e,o){if(n&&e)if(n.classList)n.classList[o?"add":"remove"](e);else{var a=(" "+n.className+" ").replace(Xt," ").replace(" "+e+" "," ");n.className=(a+(o?" "+e:"")).replace(Xt," ")}}function E(n,e,o){var a=n&&n.style;if(a){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(o=n.currentStyle),e===void 0?o:o[e];!(e in a)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),a[e]=o+(typeof o=="string"?"":"px")}}function Ce(n,e){var o="";if(typeof n=="string")o=n;else do{var a=E(n,"transform");a&&a!=="none"&&(o=a+" "+o)}while(!e&&(n=n.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(o)}function yn(n,e,o){if(n){var a=n.getElementsByTagName(e),i=0,r=a.length;if(o)for(;i<r;i++)o(a[i],i);return a}return[]}function ne(){var n=document.scrollingElement;return n||document.documentElement}function H(n,e,o,a,i){if(!(!n.getBoundingClientRect&&n!==window)){var r,s,l,c,d,g,u;if(n!==window&&n.parentNode&&n!==ne()?(r=n.getBoundingClientRect(),s=r.top,l=r.left,c=r.bottom,d=r.right,g=r.height,u=r.width):(s=0,l=0,c=window.innerHeight,d=window.innerWidth,g=window.innerHeight,u=window.innerWidth),(e||o)&&n!==window&&(i=i||n.parentNode,!le))do if(i&&i.getBoundingClientRect&&(E(i,"transform")!=="none"||o&&E(i,"position")!=="static")){var y=i.getBoundingClientRect();s-=y.top+parseInt(E(i,"border-top-width")),l-=y.left+parseInt(E(i,"border-left-width")),c=s+r.height,d=l+r.width;break}while(i=i.parentNode);if(a&&n!==window){var h=Ce(i||n),f=h&&h.a,b=h&&h.d;h&&(s/=b,l/=f,u/=f,g/=b,c=s+g,d=l+u)}return{top:s,left:l,bottom:c,right:d,width:u,height:g}}}function Jt(n,e,o){for(var a=me(n,!0),i=H(n)[e];a;){var r=H(a)[o],s=void 0;if(s=i>=r,!s)return a;if(a===ne())break;a=me(a,!1)}return!1}function Be(n,e,o,a){for(var i=0,r=0,s=n.children;r<s.length;){if(s[r].style.display!=="none"&&s[r]!==k.ghost&&(a||s[r]!==k.dragged)&&ee(s[r],o.draggable,n,!1)){if(i===e)return s[r];i++}r++}return null}function Ft(n,e){for(var o=n.lastElementChild;o&&(o===k.ghost||E(o,"display")==="none"||e&&!mt(o,e));)o=o.previousElementSibling;return o||null}function J(n,e){var o=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==k.clone&&(!e||mt(n,e))&&o++;return o}function Zt(n){var e=0,o=0,a=ne();if(n)do{var i=Ce(n),r=i.a,s=i.d;e+=n.scrollLeft*r,o+=n.scrollTop*s}while(n!==a&&(n=n.parentNode));return[e,o]}function co(n,e){for(var o in n)if(n.hasOwnProperty(o)){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===n[o][a])return Number(o)}return-1}function me(n,e){if(!n||!n.getBoundingClientRect)return ne();var o=n,a=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=E(o);if(o.clientWidth<o.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return ne();if(a||e)return o;a=!0}}while(o=o.parentNode);return ne()}function uo(n,e){if(n&&e)for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n}function xt(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var Ge;function wn(n,e){return function(){if(!Ge){var o=arguments,a=this;o.length===1?n.call(a,o[0]):n.apply(a,o),Ge=setTimeout(function(){Ge=void 0},e)}}}function po(){clearTimeout(Ge),Ge=void 0}function xn(n,e,o){n.scrollLeft+=e,n.scrollTop+=o}function _n(n){var e=window.Polymer,o=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):o?o(n).clone(!0)[0]:n.cloneNode(!0)}function En(n,e,o){var a={};return Array.from(n.children).forEach(function(i){var r,s,l,c;if(!(!ee(i,e.draggable,n,!1)||i.animated||i===o)){var d=H(i);a.left=Math.min((r=a.left)!==null&&r!==void 0?r:1/0,d.left),a.top=Math.min((s=a.top)!==null&&s!==void 0?s:1/0,d.top),a.right=Math.max((l=a.right)!==null&&l!==void 0?l:-1/0,d.right),a.bottom=Math.max((c=a.bottom)!==null&&c!==void 0?c:-1/0,d.bottom)}}),a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}var K="Sortable"+new Date().getTime();function go(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var a=[].slice.call(this.el.children);a.forEach(function(i){if(!(E(i,"display")==="none"||i===k.ghost)){n.push({target:i,rect:H(i)});var r=ae({},n[n.length-1].rect);if(i.thisAnimationDuration){var s=Ce(i,!0);s&&(r.top-=s.f,r.left-=s.e)}i.fromRect=r}})}},addAnimationState:function(a){n.push(a)},removeAnimationState:function(a){n.splice(co(n,{target:a}),1)},animateAll:function(a){var i=this;if(!this.options.animation){clearTimeout(e),typeof a=="function"&&a();return}var r=!1,s=0;n.forEach(function(l){var c=0,d=l.target,g=d.fromRect,u=H(d),y=d.prevFromRect,h=d.prevToRect,f=l.rect,b=Ce(d,!0);b&&(u.top-=b.f,u.left-=b.e),d.toRect=u,d.thisAnimationDuration&&xt(y,u)&&!xt(g,u)&&(f.top-u.top)/(f.left-u.left)===(g.top-u.top)/(g.left-u.left)&&(c=fo(f,y,h,i.options)),xt(u,g)||(d.prevFromRect=g,d.prevToRect=u,c||(c=i.options.animation),i.animate(d,f,u,c)),c&&(r=!0,s=Math.max(s,c),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},c),d.thisAnimationDuration=c)}),clearTimeout(e),r?e=setTimeout(function(){typeof a=="function"&&a()},s):typeof a=="function"&&a(),n=[]},animate:function(a,i,r,s){if(s){E(a,"transition",""),E(a,"transform","");var l=Ce(this.el),c=l&&l.a,d=l&&l.d,g=(i.left-r.left)/(c||1),u=(i.top-r.top)/(d||1);a.animatingX=!!g,a.animatingY=!!u,E(a,"transform","translate3d("+g+"px,"+u+"px,0)"),this.forRepaintDummy=mo(a),E(a,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),E(a,"transform","translate3d(0,0,0)"),typeof a.animated=="number"&&clearTimeout(a.animated),a.animated=setTimeout(function(){E(a,"transition",""),E(a,"transform",""),a.animated=!1,a.animatingX=!1,a.animatingY=!1},s)}}}}function mo(n){return n.offsetWidth}function fo(n,e,o,a){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-o.top,2)+Math.pow(e.left-o.left,2))*a.animation}var xe=[],_t={initializeByDefault:!0},et={mount:function(e){for(var o in _t)_t.hasOwnProperty(o)&&!(o in e)&&(e[o]=_t[o]);xe.forEach(function(a){if(a.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),xe.push(e)},pluginEvent:function(e,o,a){var i=this;this.eventCanceled=!1,a.cancel=function(){i.eventCanceled=!0};var r=e+"Global";xe.forEach(function(s){o[s.pluginName]&&(o[s.pluginName][r]&&o[s.pluginName][r](ae({sortable:o},a)),o.options[s.pluginName]&&o[s.pluginName][e]&&o[s.pluginName][e](ae({sortable:o},a)))})},initializePlugins:function(e,o,a,i){xe.forEach(function(l){var c=l.pluginName;if(!(!e.options[c]&&!l.initializeByDefault)){var d=new l(e,o,e.options);d.sortable=e,d.options=e.options,e[c]=d,se(a,d.defaults)}});for(var r in e.options)if(e.options.hasOwnProperty(r)){var s=this.modifyOption(e,r,e.options[r]);typeof s<"u"&&(e.options[r]=s)}},getEventProperties:function(e,o){var a={};return xe.forEach(function(i){typeof i.eventProperties=="function"&&se(a,i.eventProperties.call(o[i.pluginName],e))}),a},modifyOption:function(e,o,a){var i;return xe.forEach(function(r){e[r.pluginName]&&r.optionListeners&&typeof r.optionListeners[o]=="function"&&(i=r.optionListeners[o].call(e[r.pluginName],a))}),i}};function ho(n){var e=n.sortable,o=n.rootEl,a=n.name,i=n.targetEl,r=n.cloneEl,s=n.toEl,l=n.fromEl,c=n.oldIndex,d=n.newIndex,g=n.oldDraggableIndex,u=n.newDraggableIndex,y=n.originalEvent,h=n.putSortable,f=n.extraEventProperties;if(e=e||o&&o[K],!!e){var b,_=e.options,B="on"+a.charAt(0).toUpperCase()+a.substr(1);window.CustomEvent&&!le&&!Qe?b=new CustomEvent(a,{bubbles:!0,cancelable:!0}):(b=document.createEvent("Event"),b.initEvent(a,!0,!0)),b.to=s||o,b.from=l||o,b.item=i||o,b.clone=r,b.oldIndex=c,b.newIndex=d,b.oldDraggableIndex=g,b.newDraggableIndex=u,b.originalEvent=y,b.pullMode=h?h.lastPutMode:void 0;var x=ae(ae({},f),et.getEventProperties(a,e));for(var w in x)b[w]=x[w];o&&o.dispatchEvent(b),_[B]&&_[B].call(e,b)}}var bo=["evt"],W=function(e,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=a.evt,r=so(a,bo);et.pluginEvent.bind(k)(e,o,ae({dragEl:v,parentEl:$,ghostEl:S,rootEl:L,nextEl:ye,lastDownEl:ct,cloneEl:N,cloneHidden:ge,dragStarted:Re,putSortable:z,activeSortable:k.active,originalEvent:i,oldIndex:Ie,oldDraggableIndex:We,newIndex:X,newDraggableIndex:pe,hideGhostForTarget:Cn,unhideGhostForTarget:Tn,cloneNowHidden:function(){ge=!0},cloneNowShown:function(){ge=!1},dispatchSortableEvent:function(l){G({sortable:o,name:l,originalEvent:i})}},r))};function G(n){ho(ae({putSortable:z,cloneEl:N,targetEl:v,rootEl:L,oldIndex:Ie,oldDraggableIndex:We,newIndex:X,newDraggableIndex:pe},n))}var v,$,S,L,ye,ct,N,ge,Ie,X,We,pe,nt,z,Ee=!1,ft=!1,ht=[],be,Q,Et,kt,Qt,en,Re,_e,Ke,Ye=!1,ot=!1,dt,V,St=[],Pt=!1,bt=[],yt=typeof document<"u",at=Rt,tn=Qe||le?"cssFloat":"float",vo=yt&&!hn&&!Rt&&"draggable"in document.createElement("div"),kn=function(){if(yt){if(le)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),Sn=function(e,o){var a=E(e),i=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),r=Be(e,0,o),s=Be(e,1,o),l=r&&E(r),c=s&&E(s),d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+H(r).width,g=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+H(s).width;if(a.display==="flex")return a.flexDirection==="column"||a.flexDirection==="column-reverse"?"vertical":"horizontal";if(a.display==="grid")return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&l.float&&l.float!=="none"){var u=l.float==="left"?"left":"right";return s&&(c.clear==="both"||c.clear===u)?"vertical":"horizontal"}return r&&(l.display==="block"||l.display==="flex"||l.display==="table"||l.display==="grid"||d>=i&&a[tn]==="none"||s&&a[tn]==="none"&&d+g>i)?"vertical":"horizontal"},yo=function(e,o,a){var i=a?e.left:e.top,r=a?e.right:e.bottom,s=a?e.width:e.height,l=a?o.left:o.top,c=a?o.right:o.bottom,d=a?o.width:o.height;return i===l||r===c||i+s/2===l+d/2},wo=function(e,o){var a;return ht.some(function(i){var r=i[K].options.emptyInsertThreshold;if(!(!r||Ft(i))){var s=H(i),l=e>=s.left-r&&e<=s.right+r,c=o>=s.top-r&&o<=s.bottom+r;if(l&&c)return a=i}}),a},In=function(e){function o(r,s){return function(l,c,d,g){var u=l.options.group.name&&c.options.group.name&&l.options.group.name===c.options.group.name;if(r==null&&(s||u))return!0;if(r==null||r===!1)return!1;if(s&&r==="clone")return r;if(typeof r=="function")return o(r(l,c,d,g),s)(l,c,d,g);var y=(s?l:c).options.group.name;return r===!0||typeof r=="string"&&r===y||r.join&&r.indexOf(y)>-1}}var a={},i=e.group;(!i||lt(i)!="object")&&(i={name:i}),a.name=i.name,a.checkPull=o(i.pull,!0),a.checkPut=o(i.put),a.revertClone=i.revertClone,e.group=a},Cn=function(){!kn&&S&&E(S,"display","none")},Tn=function(){!kn&&S&&E(S,"display","")};yt&&!hn&&document.addEventListener("click",function(n){if(ft)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),ft=!1,!1},!0);var ve=function(e){if(v){e=e.touches?e.touches[0]:e;var o=wo(e.clientX,e.clientY);if(o){var a={};for(var i in e)e.hasOwnProperty(i)&&(a[i]=e[i]);a.target=a.rootEl=o,a.preventDefault=void 0,a.stopPropagation=void 0,o[K]._onDragOver(a)}}},xo=function(e){v&&v.parentNode[K]._isOutsideThisEl(e.target)};function k(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=se({},e),n[K]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Sn(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,l){s.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!Ve||Rt),emptyInsertThreshold:5};et.initializePlugins(this,n,o);for(var a in o)!(a in e)&&(e[a]=o[a]);In(e);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=e.forceFallback?!1:vo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?D(n,"pointerdown",this._onTapStart):(D(n,"mousedown",this._onTapStart),D(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(D(n,"dragover",this),D(n,"dragenter",this)),ht.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),se(this,go())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(_e=null)},_getDirection:function(e,o){return typeof this.options.direction=="function"?this.options.direction.call(this,e,o,v):this.options.direction},_onTapStart:function(e){if(e.cancelable){var o=this,a=this.el,i=this.options,r=i.preventOnFilter,s=e.type,l=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,c=(l||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||c,g=i.filter;if(Do(a),!v&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||i.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Ve&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=ee(c,i.draggable,a,!1),!(c&&c.animated)&&ct!==c)){if(Ie=J(c),We=J(c,i.draggable),typeof g=="function"){if(g.call(this,e,c,this)){G({sortable:o,rootEl:d,name:"filter",targetEl:c,toEl:a,fromEl:a}),W("filter",o,{evt:e}),r&&e.preventDefault();return}}else if(g&&(g=g.split(",").some(function(u){if(u=ee(d,u.trim(),a,!1),u)return G({sortable:o,rootEl:u,name:"filter",targetEl:c,fromEl:a,toEl:a}),W("filter",o,{evt:e}),!0}),g)){r&&e.preventDefault();return}i.handle&&!ee(d,i.handle,a,!1)||this._prepareDragStart(e,l,c)}}},_prepareDragStart:function(e,o,a){var i=this,r=i.el,s=i.options,l=r.ownerDocument,c;if(a&&!v&&a.parentNode===r){var d=H(a);if(L=r,v=a,$=v.parentNode,ye=v.nextSibling,ct=a,nt=s.group,k.dragged=v,be={target:v,clientX:(o||e).clientX,clientY:(o||e).clientY},Qt=be.clientX-d.left,en=be.clientY-d.top,this._lastX=(o||e).clientX,this._lastY=(o||e).clientY,v.style["will-change"]="all",c=function(){if(W("delayEnded",i,{evt:e}),k.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!Yt&&i.nativeDraggable&&(v.draggable=!0),i._triggerDragStart(e,o),G({sortable:i,name:"choose",originalEvent:e}),Y(v,s.chosenClass,!0)},s.ignore.split(",").forEach(function(g){yn(v,g.trim(),It)}),D(l,"dragover",ve),D(l,"mousemove",ve),D(l,"touchmove",ve),s.supportPointer?(D(l,"pointerup",i._onDrop),!this.nativeDraggable&&D(l,"pointercancel",i._onDrop)):(D(l,"mouseup",i._onDrop),D(l,"touchend",i._onDrop),D(l,"touchcancel",i._onDrop)),Yt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,v.draggable=!0),W("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||o)&&(!this.nativeDraggable||!(Qe||le))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(D(l,"pointerup",i._disableDelayedDrag),D(l,"pointercancel",i._disableDelayedDrag)):(D(l,"mouseup",i._disableDelayedDrag),D(l,"touchend",i._disableDelayedDrag),D(l,"touchcancel",i._disableDelayedDrag)),D(l,"mousemove",i._delayedDragTouchMoveHandler),D(l,"touchmove",i._delayedDragTouchMoveHandler),s.supportPointer&&D(l,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(c,s.delay)}else c()}},_delayedDragTouchMoveHandler:function(e){var o=e.touches?e.touches[0]:e;Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){v&&It(v),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;C(e,"mouseup",this._disableDelayedDrag),C(e,"touchend",this._disableDelayedDrag),C(e,"touchcancel",this._disableDelayedDrag),C(e,"pointerup",this._disableDelayedDrag),C(e,"pointercancel",this._disableDelayedDrag),C(e,"mousemove",this._delayedDragTouchMoveHandler),C(e,"touchmove",this._delayedDragTouchMoveHandler),C(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,o){o=o||e.pointerType=="touch"&&e,!this.nativeDraggable||o?this.options.supportPointer?D(document,"pointermove",this._onTouchMove):o?D(document,"touchmove",this._onTouchMove):D(document,"mousemove",this._onTouchMove):(D(v,"dragend",this),D(L,"dragstart",this._onDragStart));try{document.selection?ut(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,o){if(Ee=!1,L&&v){W("dragStarted",this,{evt:o}),this.nativeDraggable&&D(document,"dragover",xo);var a=this.options;!e&&Y(v,a.dragClass,!1),Y(v,a.ghostClass,!0),k.active=this,e&&this._appendGhost(),G({sortable:this,name:"start",originalEvent:o})}else this._nulling()},_emulateDragOver:function(){if(Q){this._lastX=Q.clientX,this._lastY=Q.clientY,Cn();for(var e=document.elementFromPoint(Q.clientX,Q.clientY),o=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Q.clientX,Q.clientY),e!==o);)o=e;if(v.parentNode[K]._isOutsideThisEl(e),o)do{if(o[K]){var a=void 0;if(a=o[K]._onDragOver({clientX:Q.clientX,clientY:Q.clientY,target:e,rootEl:o}),a&&!this.options.dragoverBubble)break}e=o}while(o=vn(o));Tn()}},_onTouchMove:function(e){if(be){var o=this.options,a=o.fallbackTolerance,i=o.fallbackOffset,r=e.touches?e.touches[0]:e,s=S&&Ce(S,!0),l=S&&s&&s.a,c=S&&s&&s.d,d=at&&V&&Zt(V),g=(r.clientX-be.clientX+i.x)/(l||1)+(d?d[0]-St[0]:0)/(l||1),u=(r.clientY-be.clientY+i.y)/(c||1)+(d?d[1]-St[1]:0)/(c||1);if(!k.active&&!Ee){if(a&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(S){s?(s.e+=g-(Et||0),s.f+=u-(kt||0)):s={a:1,b:0,c:0,d:1,e:g,f:u};var y="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");E(S,"webkitTransform",y),E(S,"mozTransform",y),E(S,"msTransform",y),E(S,"transform",y),Et=g,kt=u,Q=r}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!S){var e=this.options.fallbackOnBody?document.body:L,o=H(v,!0,at,!0,e),a=this.options;if(at){for(V=e;E(V,"position")==="static"&&E(V,"transform")==="none"&&V!==document;)V=V.parentNode;V!==document.body&&V!==document.documentElement?(V===document&&(V=ne()),o.top+=V.scrollTop,o.left+=V.scrollLeft):V=ne(),St=Zt(V)}S=v.cloneNode(!0),Y(S,a.ghostClass,!1),Y(S,a.fallbackClass,!0),Y(S,a.dragClass,!0),E(S,"transition",""),E(S,"transform",""),E(S,"box-sizing","border-box"),E(S,"margin",0),E(S,"top",o.top),E(S,"left",o.left),E(S,"width",o.width),E(S,"height",o.height),E(S,"opacity","0.8"),E(S,"position",at?"absolute":"fixed"),E(S,"zIndex","100000"),E(S,"pointerEvents","none"),k.ghost=S,e.appendChild(S),E(S,"transform-origin",Qt/parseInt(S.style.width)*100+"% "+en/parseInt(S.style.height)*100+"%")}},_onDragStart:function(e,o){var a=this,i=e.dataTransfer,r=a.options;if(W("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}W("setupClone",this),k.eventCanceled||(N=_n(v),N.removeAttribute("id"),N.draggable=!1,N.style["will-change"]="",this._hideClone(),Y(N,this.options.chosenClass,!1),k.clone=N),a.cloneId=ut(function(){W("clone",a),!k.eventCanceled&&(a.options.removeCloneOnHide||L.insertBefore(N,v),a._hideClone(),G({sortable:a,name:"clone"}))}),!o&&Y(v,r.dragClass,!0),o?(ft=!0,a._loopId=setInterval(a._emulateDragOver,50)):(C(document,"mouseup",a._onDrop),C(document,"touchend",a._onDrop),C(document,"touchcancel",a._onDrop),i&&(i.effectAllowed="move",r.setData&&r.setData.call(a,i,v)),D(document,"drop",a),E(v,"transform","translateZ(0)")),Ee=!0,a._dragStartId=ut(a._dragStarted.bind(a,o,e)),D(document,"selectstart",a),Re=!0,window.getSelection().removeAllRanges(),Ve&&E(document.body,"user-select","none")},_onDragOver:function(e){var o=this.el,a=e.target,i,r,s,l=this.options,c=l.group,d=k.active,g=nt===c,u=l.sort,y=z||d,h,f=this,b=!1;if(Pt)return;function _(Pe,Pn){W(Pe,f,ae({evt:e,isOwner:g,axis:h?"vertical":"horizontal",revert:s,dragRect:i,targetRect:r,canSort:u,fromSortable:y,target:a,completed:x,onMove:function(Vt,$n){return it(L,o,v,i,Vt,H(Vt),e,$n)},changed:w},Pn))}function B(){_("dragOverAnimationCapture"),f.captureAnimationState(),f!==y&&y.captureAnimationState()}function x(Pe){return _("dragOverCompleted",{insertion:Pe}),Pe&&(g?d._hideClone():d._showClone(f),f!==y&&(Y(v,z?z.options.ghostClass:d.options.ghostClass,!1),Y(v,l.ghostClass,!0)),z!==f&&f!==k.active?z=f:f===k.active&&z&&(z=null),y===f&&(f._ignoreWhileAnimating=a),f.animateAll(function(){_("dragOverAnimationComplete"),f._ignoreWhileAnimating=null}),f!==y&&(y.animateAll(),y._ignoreWhileAnimating=null)),(a===v&&!v.animated||a===o&&!a.animated)&&(_e=null),!l.dragoverBubble&&!e.rootEl&&a!==document&&(v.parentNode[K]._isOutsideThisEl(e.target),!Pe&&ve(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),b=!0}function w(){X=J(v),pe=J(v,l.draggable),G({sortable:f,name:"change",toEl:o,newIndex:X,newDraggableIndex:pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),a=ee(a,l.draggable,o,!0),_("dragOver"),k.eventCanceled)return b;if(v.contains(e.target)||a.animated&&a.animatingX&&a.animatingY||f._ignoreWhileAnimating===a)return x(!1);if(ft=!1,d&&!l.disabled&&(g?u||(s=$!==L):z===this||(this.lastPutMode=nt.checkPull(this,d,v,e))&&c.checkPut(this,d,v,e))){if(h=this._getDirection(e,a)==="vertical",i=H(v),_("dragOverValid"),k.eventCanceled)return b;if(s)return $=L,B(),this._hideClone(),_("revert"),k.eventCanceled||(ye?L.insertBefore(v,ye):L.appendChild(v)),x(!0);var T=Ft(o,l.draggable);if(!T||So(e,h,this)&&!T.animated){if(T===v)return x(!1);if(T&&o===e.target&&(a=T),a&&(r=H(a)),it(L,o,v,i,a,r,e,!!a)!==!1)return B(),T&&T.nextSibling?o.insertBefore(v,T.nextSibling):o.appendChild(v),$=o,w(),x(!0)}else if(T&&ko(e,h,this)){var j=Be(o,0,l,!0);if(j===v)return x(!1);if(a=j,r=H(a),it(L,o,v,i,a,r,e,!1)!==!1)return B(),o.insertBefore(v,j),$=o,w(),x(!0)}else if(a.parentNode===o){r=H(a);var P=0,R,F=v.parentNode!==o,U=!yo(v.animated&&v.toRect||i,a.animated&&a.toRect||r,h),Ae=h?"top":"left",ce=Jt(a,"top","top")||Jt(v,"top","top"),Le=ce?ce.scrollTop:void 0;_e!==a&&(R=r[Ae],Ye=!1,ot=!U&&l.invertSwap||F),P=Io(e,a,r,h,U?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,ot,_e===a);var ie;if(P!==0){var fe=J(v);do fe-=P,ie=$.children[fe];while(ie&&(E(ie,"display")==="none"||ie===S))}if(P===0||ie===a)return x(!1);_e=a,Ke=P;var Ne=a.nextElementSibling,de=!1;de=P===1;var tt=it(L,o,v,i,a,r,e,de);if(tt!==!1)return(tt===1||tt===-1)&&(de=tt===1),Pt=!0,setTimeout(Eo,30),B(),de&&!Ne?o.appendChild(v):a.parentNode.insertBefore(v,de?Ne:a),ce&&xn(ce,0,Le-ce.scrollTop),$=v.parentNode,R!==void 0&&!ot&&(dt=Math.abs(R-H(a)[Ae])),w(),x(!0)}if(o.contains(v))return x(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){C(document,"mousemove",this._onTouchMove),C(document,"touchmove",this._onTouchMove),C(document,"pointermove",this._onTouchMove),C(document,"dragover",ve),C(document,"mousemove",ve),C(document,"touchmove",ve)},_offUpEvents:function(){var e=this.el.ownerDocument;C(e,"mouseup",this._onDrop),C(e,"touchend",this._onDrop),C(e,"pointerup",this._onDrop),C(e,"pointercancel",this._onDrop),C(e,"touchcancel",this._onDrop),C(document,"selectstart",this)},_onDrop:function(e){var o=this.el,a=this.options;if(X=J(v),pe=J(v,a.draggable),W("drop",this,{evt:e}),$=v&&v.parentNode,X=J(v),pe=J(v,a.draggable),k.eventCanceled){this._nulling();return}Ee=!1,ot=!1,Ye=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),$t(this.cloneId),$t(this._dragStartId),this.nativeDraggable&&(C(document,"drop",this),C(o,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ve&&E(document.body,"user-select",""),E(v,"transform",""),e&&(Re&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),S&&S.parentNode&&S.parentNode.removeChild(S),(L===$||z&&z.lastPutMode!=="clone")&&N&&N.parentNode&&N.parentNode.removeChild(N),v&&(this.nativeDraggable&&C(v,"dragend",this),It(v),v.style["will-change"]="",Re&&!Ee&&Y(v,z?z.options.ghostClass:this.options.ghostClass,!1),Y(v,this.options.chosenClass,!1),G({sortable:this,name:"unchoose",toEl:$,newIndex:null,newDraggableIndex:null,originalEvent:e}),L!==$?(X>=0&&(G({rootEl:$,name:"add",toEl:$,fromEl:L,originalEvent:e}),G({sortable:this,name:"remove",toEl:$,originalEvent:e}),G({rootEl:$,name:"sort",toEl:$,fromEl:L,originalEvent:e}),G({sortable:this,name:"sort",toEl:$,originalEvent:e})),z&&z.save()):X!==Ie&&X>=0&&(G({sortable:this,name:"update",toEl:$,originalEvent:e}),G({sortable:this,name:"sort",toEl:$,originalEvent:e})),k.active&&((X==null||X===-1)&&(X=Ie,pe=We),G({sortable:this,name:"end",toEl:$,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){W("nulling",this),L=v=$=S=ye=N=ct=ge=be=Q=Re=X=pe=Ie=We=_e=Ke=z=nt=k.dragged=k.ghost=k.clone=k.active=null,bt.forEach(function(e){e.checked=!0}),bt.length=Et=kt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":v&&(this._onDragOver(e),_o(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],o,a=this.el.children,i=0,r=a.length,s=this.options;i<r;i++)o=a[i],ee(o,s.draggable,this.el,!1)&&e.push(o.getAttribute(s.dataIdAttr)||To(o));return e},sort:function(e,o){var a={},i=this.el;this.toArray().forEach(function(r,s){var l=i.children[s];ee(l,this.options.draggable,i,!1)&&(a[r]=l)},this),o&&this.captureAnimationState(),e.forEach(function(r){a[r]&&(i.removeChild(a[r]),i.appendChild(a[r]))}),o&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,o){return ee(e,o||this.options.draggable,this.el,!1)},option:function(e,o){var a=this.options;if(o===void 0)return a[e];var i=et.modifyOption(this,e,o);typeof i<"u"?a[e]=i:a[e]=o,e==="group"&&In(a)},destroy:function(){W("destroy",this);var e=this.el;e[K]=null,C(e,"mousedown",this._onTapStart),C(e,"touchstart",this._onTapStart),C(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(C(e,"dragover",this),C(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(o){o.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ht.splice(ht.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ge){if(W("hideClone",this),k.eventCanceled)return;E(N,"display","none"),this.options.removeCloneOnHide&&N.parentNode&&N.parentNode.removeChild(N),ge=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(ge){if(W("showClone",this),k.eventCanceled)return;v.parentNode==L&&!this.options.group.revertClone?L.insertBefore(N,v):ye?L.insertBefore(N,ye):L.appendChild(N),this.options.group.revertClone&&this.animate(v,N),E(N,"display",""),ge=!1}}};function _o(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function it(n,e,o,a,i,r,s,l){var c,d=n[K],g=d.options.onMove,u;return window.CustomEvent&&!le&&!Qe?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=e,c.from=n,c.dragged=o,c.draggedRect=a,c.related=i||e,c.relatedRect=r||H(e),c.willInsertAfter=l,c.originalEvent=s,n.dispatchEvent(c),g&&(u=g.call(d,c,s)),u}function It(n){n.draggable=!1}function Eo(){Pt=!1}function ko(n,e,o){var a=H(Be(o.el,0,o.options,!0)),i=En(o.el,o.options,S),r=10;return e?n.clientX<i.left-r||n.clientY<a.top&&n.clientX<a.right:n.clientY<i.top-r||n.clientY<a.bottom&&n.clientX<a.left}function So(n,e,o){var a=H(Ft(o.el,o.options.draggable)),i=En(o.el,o.options,S),r=10;return e?n.clientX>i.right+r||n.clientY>a.bottom&&n.clientX>a.left:n.clientY>i.bottom+r||n.clientX>a.right&&n.clientY>a.top}function Io(n,e,o,a,i,r,s,l){var c=a?n.clientY:n.clientX,d=a?o.height:o.width,g=a?o.top:o.left,u=a?o.bottom:o.right,y=!1;if(!s){if(l&&dt<d*i){if(!Ye&&(Ke===1?c>g+d*r/2:c<u-d*r/2)&&(Ye=!0),Ye)y=!0;else if(Ke===1?c<g+dt:c>u-dt)return-Ke}else if(c>g+d*(1-i)/2&&c<u-d*(1-i)/2)return Co(e)}return y=y||s,y&&(c<g+d*r/2||c>u-d*r/2)?c>g+d/2?1:-1:0}function Co(n){return J(v)<J(n)?1:-1}function To(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,o=e.length,a=0;o--;)a+=e.charCodeAt(o);return a.toString(36)}function Do(n){bt.length=0;for(var e=n.getElementsByTagName("input"),o=e.length;o--;){var a=e[o];a.checked&&bt.push(a)}}function ut(n){return setTimeout(n,0)}function $t(n){return clearTimeout(n)}yt&&D(document,"touchmove",function(n){(k.active||Ee)&&n.cancelable&&n.preventDefault()});k.utils={on:D,off:C,css:E,find:yn,is:function(e,o){return!!ee(e,o,e,!1)},extend:uo,throttle:wn,closest:ee,toggleClass:Y,clone:_n,index:J,nextTick:ut,cancelNextTick:$t,detectDirection:Sn,getChild:Be,expando:K};k.get=function(n){return n[K]};k.mount=function(){for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];e[0].constructor===Array&&(e=e[0]),e.forEach(function(a){if(!a.prototype||!a.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(a));a.utils&&(k.utils=ae(ae({},k.utils),a.utils)),et.mount(a)})};k.create=function(n,e){return new k(n,e)};k.version=lo;var M=[],Fe,Ot,Mt=!1,Ct,Tt,vt,ze;function Bo(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(o){var a=o.originalEvent;this.sortable.nativeDraggable?D(document,"dragover",this._handleAutoScroll):this.options.supportPointer?D(document,"pointermove",this._handleFallbackAutoScroll):a.touches?D(document,"touchmove",this._handleFallbackAutoScroll):D(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(o){var a=o.originalEvent;!this.options.dragOverBubble&&!a.rootEl&&this._handleAutoScroll(a)},drop:function(){this.sortable.nativeDraggable?C(document,"dragover",this._handleAutoScroll):(C(document,"pointermove",this._handleFallbackAutoScroll),C(document,"touchmove",this._handleFallbackAutoScroll),C(document,"mousemove",this._handleFallbackAutoScroll)),nn(),pt(),po()},nulling:function(){vt=Ot=Fe=Mt=ze=Ct=Tt=null,M.length=0},_handleFallbackAutoScroll:function(o){this._handleAutoScroll(o,!0)},_handleAutoScroll:function(o,a){var i=this,r=(o.touches?o.touches[0]:o).clientX,s=(o.touches?o.touches[0]:o).clientY,l=document.elementFromPoint(r,s);if(vt=o,a||this.options.forceAutoScrollFallback||Qe||le||Ve){Dt(o,this.options,l,a);var c=me(l,!0);Mt&&(!ze||r!==Ct||s!==Tt)&&(ze&&nn(),ze=setInterval(function(){var d=me(document.elementFromPoint(r,s),!0);d!==c&&(c=d,pt()),Dt(o,i.options,d,a)},10),Ct=r,Tt=s)}else{if(!this.options.bubbleScroll||me(l,!0)===ne()){pt();return}Dt(o,this.options,me(l,!1),!1)}}},se(n,{pluginName:"scroll",initializeByDefault:!0})}function pt(){M.forEach(function(n){clearInterval(n.pid)}),M=[]}function nn(){clearInterval(ze)}var Dt=wn(function(n,e,o,a){if(e.scroll){var i=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,s=e.scrollSensitivity,l=e.scrollSpeed,c=ne(),d=!1,g;Ot!==o&&(Ot=o,pt(),Fe=e.scroll,g=e.scrollFn,Fe===!0&&(Fe=me(o,!0)));var u=0,y=Fe;do{var h=y,f=H(h),b=f.top,_=f.bottom,B=f.left,x=f.right,w=f.width,T=f.height,j=void 0,P=void 0,R=h.scrollWidth,F=h.scrollHeight,U=E(h),Ae=h.scrollLeft,ce=h.scrollTop;h===c?(j=w<R&&(U.overflowX==="auto"||U.overflowX==="scroll"||U.overflowX==="visible"),P=T<F&&(U.overflowY==="auto"||U.overflowY==="scroll"||U.overflowY==="visible")):(j=w<R&&(U.overflowX==="auto"||U.overflowX==="scroll"),P=T<F&&(U.overflowY==="auto"||U.overflowY==="scroll"));var Le=j&&(Math.abs(x-i)<=s&&Ae+w<R)-(Math.abs(B-i)<=s&&!!Ae),ie=P&&(Math.abs(_-r)<=s&&ce+T<F)-(Math.abs(b-r)<=s&&!!ce);if(!M[u])for(var fe=0;fe<=u;fe++)M[fe]||(M[fe]={});(M[u].vx!=Le||M[u].vy!=ie||M[u].el!==h)&&(M[u].el=h,M[u].vx=Le,M[u].vy=ie,clearInterval(M[u].pid),(Le!=0||ie!=0)&&(d=!0,M[u].pid=setInterval((function(){a&&this.layer===0&&k.active._onTouchMove(vt);var Ne=M[this.layer].vy?M[this.layer].vy*l:0,de=M[this.layer].vx?M[this.layer].vx*l:0;typeof g=="function"&&g.call(k.dragged.parentNode[K],de,Ne,n,vt,M[this.layer].el)!=="continue"||xn(M[this.layer].el,de,Ne)}).bind({layer:u}),24))),u++}while(e.bubbleScroll&&y!==c&&(y=me(y,!1)));Mt=d}},30),Dn=function(e){var o=e.originalEvent,a=e.putSortable,i=e.dragEl,r=e.activeSortable,s=e.dispatchSortableEvent,l=e.hideGhostForTarget,c=e.unhideGhostForTarget;if(o){var d=a||r;l();var g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o,u=document.elementFromPoint(g.clientX,g.clientY);c(),d&&!d.el.contains(u)&&(s("spill"),this.onSpill({dragEl:i,putSortable:a}))}};function zt(){}zt.prototype={startIndex:null,dragStart:function(e){var o=e.oldDraggableIndex;this.startIndex=o},onSpill:function(e){var o=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var i=Be(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(o,i):this.sortable.el.appendChild(o),this.sortable.animateAll(),a&&a.animateAll()},drop:Dn};se(zt,{pluginName:"revertOnSpill"});function qt(){}qt.prototype={onSpill:function(e){var o=e.dragEl,a=e.putSortable,i=a||this.sortable;i.captureAnimationState(),o.parentNode&&o.parentNode.removeChild(o),i.animateAll()},drop:Dn};se(qt,{pluginName:"removeOnSpill"});k.mount(new Bo);k.mount(qt,zt);function Ut(n){const e=document.getElementById("notes-grid");if(!e)return;e.innerHTML="";const o=p.currentView==="all"?p.notes.filter(s=>{const l=p.categories.find(c=>c.id===s.categoryId);return!l||!l.passwordHash}):p.notes.filter(s=>s.categoryId===p.currentView),a=o.filter(s=>s.pinned),i=o.filter(s=>!s.pinned),r=s=>{const l=document.createElement("div");l.className="note-card note-animate-in relative group",l.dataset.id=s.id;const c=Xe.find(y=>y.id===s.themeId)||Xe[0],d=p.settings.theme==="dark"?c.dark:c.light;s.themeId!=="default"&&(l.style.backgroundColor=d,l.style.borderColor=p.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)");const g=p.categories.find(y=>y.id===s.categoryId),u=p.unlockedNotes.has(s.id);return l.innerHTML=`
            <div class="note-card-content">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-base line-clamp-2 leading-snug flex-1 pr-3">${s.title}</h3>
                    <div class="flex items-center gap-2 shrink-0 pt-0.5">
                        ${s.pinned?'<i data-lucide="pin" class="w-4 h-4 fill-current text-primary"></i>':""}
                        ${s.passwordHash?`<i data-lucide="${u?"unlock":"lock"}" class="w-4 h-4 lock-indicator cursor-pointer opacity-80" data-id="${s.id}"></i>`:""}
                    </div>
                </div>
                <div class="text-[13px] opacity-70 line-clamp-6 leading-relaxed mb-4 flex-1">
                    ${s.passwordHash&&!u?`<div class="flex items-center gap-3 py-8 italic opacity-50"><i data-lucide="shield-alert" class="w-6 h-6"></i> ${m("common.restricted_access")}</div>`:s.content}
                </div>
                ${g&&p.currentView==="all"?`
                <div class="mt-auto">
                    <span class="flex items-center gap-2 text-[10px] px-3 py-1.5 rounded-full bg-primary border border-primary/20 font-bold text-primary-foreground uppercase tracking-widest">
                        <i data-lucide="${g.icon||"tag"}" class="w-3.5 h-3.5 text-primary-foreground"></i>
                        ${g.name}
                    </span>
                </div>`:""}
            </div>
        `,l.onclick=async y=>{if(!y.target.closest(".delete-note-btn")){if(s.passwordHash&&!p.unlockedNotes.has(s.id)){try{const h=await oe(m("common.security_prompt"),m("common.security_desc_prompt"));if(!h)return;if(await O.hash(h)!==s.passwordHash){I(m("auth.incorrect_pass"));return}p.unlockedNotes.add(s.id),n(s),setTimeout(()=>Ut(n),300)}catch(h){console.error("Error unlocking note:",h),I("‚ùå Error al desbloquear")}return}n(s)}},l};if(a.length>0){const s=document.createElement("h3");if(s.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2 flex items-center gap-2",s.innerHTML='<i data-lucide="pin" class="w-3 h-3"></i> '+m("header.pinned"),e.appendChild(s),a.forEach(l=>e.appendChild(r(l))),i.length>0){const l=document.createElement("div");l.className="col-span-full h-px bg-border my-4",e.appendChild(l)}}if(i.length>0){if(a.length>0){const s=document.createElement("h3");s.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2",s.innerText=m("sidebar.all_notes"),e.appendChild(s)}i.forEach(s=>e.appendChild(r(s)))}o.length===0&&(e.innerHTML=`<div class="col-span-full text-center py-20 text-muted-foreground opacity-50">
            <i data-lucide="ghost" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
            <p>${m("notes.no_notes")}</p>
        </div>`),q(),Ao()}function Ao(n){const e=document.getElementById("notes-grid");e&&(e.sortable&&e.sortable.destroy(),e.sortable=k.create(e,{animation:250,ghostClass:"opacity-50",delay:500,delayOnTouchOnly:!0,onEnd:async()=>{const o=[];e.querySelectorAll(".note-card").forEach(r=>{const s=p.notes.find(l=>l.id===r.dataset.id);s&&o.push(s)});const a=new Set(o.map(r=>r.id)),i=p.notes.filter(r=>!a.has(r.id));p.notes=[...o,...i],await Z()}}))}const Lo="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com";let $e=null;async function on(){console.log("Iniciando aplicaci√≥n modular..."),Un();const n=localStorage.getItem("cn_vault_key_v3");n&&sessionStorage.setItem("cn_vault_key_v3",n),No(),Rn(),An(),Yn(te),oo(),Po();const e=localStorage.getItem("cn_last_version");if(e&&e!==Me){localStorage.setItem("cn_last_version",Me),console.log(`Nueva versi√≥n detectada (${Me}). Recargando...`),I("üöÄ Actualizando a la √∫ltima versi√≥n..."),setTimeout(()=>location.reload(!0),1500);return}localStorage.setItem("cn_last_version",Me),await mn(te),$o(),Oo(),Ho(),jo(),Mo(),Fo(),zo(),q(),console.log("Aplicaci√≥n lista.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",on):on();function No(){const n=document.getElementById("root");if(!n)return console.error("No se encontr√≥ el elemento #root");n.innerHTML=`
        ${gn()}
        ${Wn()}
        ${Kn()}
        ${Zn()}
        ${no()}
        ${ao()}
    `,console.log("Estructura inyectada.")}function te(){Ut(qe),jt(wt,p.categories),Bn(),q()}function wt(n,e){p.currentView=n,Bn(e),Ut(qe),document.querySelectorAll("[data-view]").forEach(o=>{o.classList.toggle("active",o.dataset.view===n)}),jt(wt)}function Bn(n=null){const e=document.getElementById("view-title"),o=document.getElementById("view-desc");if(!e)return;const a=p.categories.find(r=>r.id===p.currentView),i=n||(a?a.name:t("header.view_title_all"));e.innerText=i,o&&(o.innerText=p.currentView==="all"?"Organiza tus pensamientos y protege tu privacidad.":"",o.style.display=p.currentView==="all"?"block":"none")}function An(){const n=p.settings.theme==="dark";document.documentElement.classList.toggle("dark",n),document.documentElement.classList.toggle("light",!n)}function A(n,e){const o=document.getElementById(n);o&&(o.onclick=e)}function Po(){A("add-note-btn",()=>qe()),A("mobile-add-btn",()=>qe()),A("sync-btn",Te),A("mobile-sync-btn",Te),A("mobile-sync-btn-bottom",Te),A("settings-trigger",ln),A("mobile-settings-btn",()=>{ke(),ln()}),A("sidebar-collapse-btn",()=>{const r=document.querySelector("aside");r.classList.toggle("collapsed");const s=r.classList.contains("collapsed");localStorage.setItem("sidebar_collapsed",s),Nn()}),A("mobile-force-reload-btn",Nt),document.body.addEventListener("click",r=>{r.target.closest("#logout-btn, #mobile-logout-btn")&&sn(),r.target.id==="mobile-sidebar-overlay"&&ke()});const n=async()=>{p.settings.drivePath=document.getElementById("config-drive-path").value,p.settings.algo=document.getElementById("config-algo").value,p.settings.notesPerChunk=parseInt(document.getElementById("config-notes-per-chunk").value)||50,await Z(),I("‚úÖ Configuraci√≥n guardada"),an()};A("save-sync-config",n),A("save-security-config",n),A("connect-drive-btn",Ln),A("theme-light",()=>cn("light")),A("theme-dark",()=>cn("dark")),document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view], .nav-link-mobile-drawer[data-view]").forEach(r=>{r.onclick=()=>{const s=r.dataset.view,l=p.categories.find(d=>d.id===s),c=l?l.name:s==="all"?t("header.view_title_all"):"";wt(s,c),ke()}}),document.querySelectorAll(".nav-link-mobile-drawer[data-category]").forEach(r=>{r.onclick=s=>{s.preventDefault();const l=r.dataset.category;p.currentView=l,document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view]").forEach(c=>c.classList.remove("active")),document.querySelectorAll("#sidebar-categories .nav-link").forEach(c=>c.classList.remove("active")),document.querySelectorAll(".nav-link-mobile-drawer").forEach(c=>{const d=c.dataset.category===l;c.classList.toggle("active",d);const g=c.querySelector("i");g&&g.classList.toggle("text-primary",d);const u=c.querySelector("span");u&&u.classList.toggle("text-primary",d)}),ke(),te()}}),A("sidebar-manage-cats",rn),A("mobile-manage-cats",()=>{ke(),rn()}),A("add-cat-btn",Ro);const o=r=>{const s=r.target.closest("#settings-modal, #categories-modal, #editor-modal");s&&s.classList.add("hidden")};document.querySelectorAll(".close-modal, .close-settings, .close-categories").forEach(r=>{r.onclick=o}),document.body.addEventListener("click",r=>{const s=r.target.closest(".toggle-pass");if(!s)return;const l=document.getElementById(s.dataset.target);if(!l)return;const c=l.type==="password";l.type=c?"text":"password",s.innerHTML=`<i data-lucide="${c?"eye-off":"eye"}" class="w-4 h-4"></i>`,q()}),document.body.addEventListener("keydown",r=>{if(r.key==="Enter"){const s=document.getElementById("auth-shield");if(s&&!s.classList.contains("hidden")){const l=document.getElementById("master-password"),c=document.getElementById("confirm-password");(document.activeElement===l||document.activeElement===c)&&At(te)}}}),A("auth-submit",()=>At(te)),A("auth-biometric",()=>{rt(()=>Promise.resolve().then(()=>Gn),void 0).then(r=>{r.handleBiometricAuth(te)})});const a=document.getElementById("factory-reset-confirm"),i=document.getElementById("factory-reset");if(a&&i){const r=t("settings.reset_keyword").toLowerCase();a.oninput=()=>{i.disabled=a.value.toLowerCase()!==r},i.onclick=()=>{a.value.toLowerCase()===r&&(localStorage.clear(),sessionStorage.clear(),location.reload())}}window.triggerAutoSync=an,window.handleLogout=sn,window.openEditor=qe}function $o(){const n=a=>{const i=a.target.value.toLowerCase();document.querySelectorAll(".note-card").forEach(s=>{const l=p.notes.find(d=>d.id===s.dataset.id);if(!l)return;const c=l.title.toLowerCase().includes(i)||l.content.toLowerCase().includes(i);s.classList.toggle("hidden",!c)})},e=document.getElementById("search-input"),o=document.getElementById("mobile-search-input-top");e&&(e.oninput=n),o&&(o.oninput=n)}function Oo(){const n=document.getElementById("mobile-sidebar-overlay"),e=()=>{n==null||n.classList.remove("hidden"),jt(wt,p.categories)};A("mobile-sidebar-trigger",e),A("mobile-sidebar-trigger-bottom",e),A("close-mobile-sidebar",ke);const o=document.getElementById("mobile-search-bar"),a=document.getElementById("mobile-search-input-top"),i=()=>{o==null||o.classList.remove("hidden"),a==null||a.focus()};A("mobile-search-btn",i),A("mobile-search-trigger",i),A("close-mobile-search",()=>{o&&o.classList.add("hidden"),a&&(a.value="",a.dispatchEvent(new Event("input")))}),A("mobile-search-trigger",async()=>{const r=await oe("Buscar Notas","Ingresa t√©rmino de b√∫squeda:");if(r!==null){const s=document.getElementById("search-input");if(s){s.value=r,s.dispatchEvent(new Event("input"));const l=document.getElementById("notes-viewport");l&&(l.scrollTop=0)}}})}function Mo(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registrado corectamente:",e.scope)}).catch(e=>{console.log("Fallo al registrar SW:",e)})})}function Ho(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),$e=e,["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(a=>{var i;return(i=document.getElementById(a))==null?void 0:i.classList.remove("hidden")})});const n=async()=>{if(!$e)return;$e.prompt();const{outcome:e}=await $e.userChoice;e==="accepted"&&["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(a=>{var i;return(i=document.getElementById(a))==null?void 0:i.classList.add("hidden")}),$e=null};A("pwa-install-btn",n),A("sidebar-pwa-install-btn",n),A("mobile-pwa-install-btn",n)}function jo(){const n=setInterval(()=>{typeof gapi<"u"&&typeof google<"u"&&google.accounts&&(clearInterval(n),gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),p.gapiLoaded=!0,p.tokenClient=google.accounts.oauth2.initTokenClient({client_id:Lo,scope:"https://www.googleapis.com/auth/drive.file",callback:async o=>{if(o.error)return I("‚ùå Error de vinculaci√≥n");const a=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!a)return I("‚ùå Error: Sesi√≥n no v√°lida");try{const i=new un("notev3_",p.settings.drivePath,p.settings.notesPerChunk),r=await i.getOrCreateFolder(p.settings.drivePath);gapi.client.setToken(o),await i.loadChunks(r,a)&&I("‚úÖ Drive verificado: Contrase√±a correcta"),localStorage.setItem("gdrive_token_v3",JSON.stringify(o)),gapi.client.setToken(o),Oe(!0),I("‚úÖ Vinculado con Google Drive"),Te()}catch(i){console.error("Drive connection error:",i),I("‚ùå Error al verificar Drive")}}});const e=localStorage.getItem("gdrive_token_v3");if(e){const o=JSON.parse(e);gapi.client.setToken(o),Oe(!0),setTimeout(()=>Oe(!0),500),setTimeout(()=>Oe(!0),2e3)}else Oe(!1)}))},500)}function Ln(){if(!p.tokenClient)return I(typeof gapi>"u"||typeof google>"u"?"‚è≥ Cargando librer√≠as de Google...":"‚è≥ Inicializando API de Google...");p.tokenClient.requestAccessToken({prompt:""})}function Oe(n){const e=document.getElementById("drive-status"),o=document.getElementById("sync-btn");e&&(e.innerHTML=n?'<span class="flex items-center gap-2 text-green-500 font-bold"><i data-lucide="check-circle" class="w-4 h-4"></i> Conectado</span>':'<span class="flex items-center gap-2 text-muted-foreground font-bold font-mono uppercase"><i data-lucide="x-circle" class="w-4 h-4"></i> No conectado</span>',e.className=n?"text-[10px] px-2 py-0.5 rounded-full bg-primary/10 text-primary":"text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground"),o&&(o.style.opacity=n?"1":"0.3",o.style.pointerEvents=n?"auto":"none"),q()}let Bt=!1;async function Te(){if(Bt)return;const n=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!n)return;const e=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),o=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");Bt=!0,e.forEach(a=>a.classList.add("animate-spin")),o.forEach(a=>a.classList.add("text-primary"));try{const a=new un("notev3_",p.settings.drivePath,p.settings.notesPerChunk),i=await a.getOrCreateFolder(p.settings.drivePath),r=await a.loadChunks(i,n);if(r)try{if(r&&Array.isArray(r.notes)){const s=new Map(r.notes.map(h=>[h.id,h])),l=new Map(p.notes.map(h=>[h.id,h])),c=new Set([...s.keys(),...l.keys()]),d=Array.from(c).map(h=>{const f=l.get(h),b=s.get(h);return f?b&&b.updatedAt>f.updatedAt?b:f:b});p.notes=d.sort((h,f)=>f.updatedAt-h.updatedAt);const g=new Map(r.categories.map(h=>[h.id,h])),u=new Map(p.categories.map(h=>[h.id,h])),y=new Set([...g.keys(),...u.keys()]);p.categories=Array.from(y).map(h=>u.get(h)||g.get(h)),await Z(),te()}}catch(s){console.error("Decryption failed during sync pull",s),I("‚ö†Ô∏è No se pudo descargar: Contrase√±a no coincide")}await a.saveChunks(p.notes,p.categories,n,i),I("‚úÖ Sincronizaci√≥n completa")}catch(a){console.error("Sync error:",a),a.status===401||a.result&&a.result.error&&a.result.error.code===401?(I("‚ö†Ô∏è Sesi√≥n de Drive expirada. Re-conectando..."),Ln()):I("‚ùå Error de sincronizaci√≥n")}finally{Bt=!1;const a=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),i=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");a.forEach(r=>r.classList.remove("animate-spin")),i.forEach(r=>r.classList.remove("text-primary"))}}function an(){const n=localStorage.getItem("gdrive_token_v3"),e=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");p.gapiLoaded&&n&&e&&Te()}function rn(){const n=document.getElementById("categories-modal");n&&(n.classList.remove("hidden"),Ze(te,p.categories))}function ke(){const n=document.getElementById("mobile-sidebar-overlay"),e=document.getElementById("mobile-sidebar-drawer");!n||n.classList.contains("hidden")||(e?(e.classList.add("animate-out","slide-out-to-left"),n.classList.add("fade-out"),setTimeout(()=>{n.classList.add("hidden"),e.classList.remove("animate-out","slide-out-to-left")},200)):n.classList.add("hidden"))}async function Ro(){const n=document.getElementById("new-cat-name"),e=n==null?void 0:n.value.trim();if(!e)return;const o={id:"cat_"+Date.now(),name:e,icon:"tag",passwordHash:null};p.categories.push(o),await Z(),n&&(n.value=""),Ze(te,p.categories),te(),localStorage.getItem("gdrive_token_v3")&&Te()}function sn(){localStorage.removeItem("cn_vault_key_v3"),sessionStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),location.reload()}function Fo(){["app-version","settings-version-display","mobile-app-version"].forEach(n=>{const e=document.getElementById(n);e&&(e.innerText=Me)})}function ln(){const n=document.getElementById("settings-modal");if(n){n.classList.remove("hidden"),document.getElementById("config-drive-path").value=p.settings.drivePath,document.getElementById("config-algo").value=p.settings.algo,document.getElementById("config-sync-chunk-size")&&(document.getElementById("config-sync-chunk-size").value=p.settings.syncChunkSize||500);const e=n.querySelector('.settings-tab[data-tab="appearance"]');if(e&&window.innerWidth>=768&&e.click(),window.innerWidth<768){const o=document.getElementById("settings-sidebar"),a=document.getElementById("settings-content-area");o&&a&&(o.classList.remove("hidden"),a.classList.add("hidden"))}}}function zo(){const n=localStorage.getItem("sidebar_collapsed")==="true",e=document.querySelector("aside");e&&n&&(e.classList.add("collapsed"),Nn())}function Nn(){const n=document.querySelector("aside");if(!n)return;const e=n.classList.contains("collapsed"),o=document.getElementById("sidebar-collapse-icon");o&&(o.setAttribute("data-lucide",e?"chevrons-right":"chevrons-left"),q())}function cn(n){p.settings.theme=n,An(),Z()}
