(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const I="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com",N="https://www.googleapis.com/auth/drive.file",x="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",E="cloud_notes_db.json";let a=JSON.parse(localStorage.getItem("cloud_notes")||"[]"),L,T=!1;const v=document.getElementById("notes-grid"),d=document.getElementById("note-title"),l=document.getElementById("note-content"),w=document.getElementById("note-actions"),B=document.getElementById("save-note"),A=document.getElementById("sync-btn"),m=document.getElementById("auth-btn"),C=document.getElementById("status-bar"),O=document.getElementById("status-text");document.addEventListener("DOMContentLoaded",()=>{u(),k(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>console.log("SW Registered",e)).catch(e=>console.log("SW Error",e))});function k(){l.addEventListener("focus",()=>{d.classList.remove("hidden"),w.classList.remove("hidden")}),document.addEventListener("click",e=>{!document.querySelector(".note-input-card").contains(e.target)&&l.value===""&&d.value===""&&(d.classList.add("hidden"),w.classList.add("hidden"))}),B.addEventListener("click",P),A.addEventListener("click",b),m.addEventListener("click",S),D(),_()}function D(){gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:[x]}),T=!0})}function _(){L=google.accounts.oauth2.initTokenClient({client_id:I,scope:N,callback:async e=>{if(e.error!==void 0)throw e;g("Conectado con Google"),m.querySelector(".text").innerText="Conectado",m.classList.add("connected"),await b()}})}async function S(){L.requestAccessToken({prompt:""})}function u(){v.innerHTML="",a.sort((e,t)=>t.updatedAt-e.updatedAt).forEach(e=>{const t=document.createElement("div");t.className="note-card group",t.innerHTML=`
            <button class="absolute top-4 right-4 w-8 h-8 rounded-lg bg-red-500/10 text-red-500 opacity-0 group-hover:opacity-100 transition-all hover:bg-red-500 hover:text-white" onclick="deleteNote('${e.id}')">✕</button>
            <h3 class="text-lg font-bold mb-2 pr-8">${e.title||"Sin título"}</h3>
            <p class="text-text-muted leading-relaxed whitespace-pre-wrap">${e.content}</p>
            <div class="mt-6 flex items-center justify-between opacity-40 text-[10px] font-mono tracking-tighter uppercase">
                <span>Guardado</span>
                <span>${new Date(e.updatedAt).toLocaleDateString()}</span>
            </div>
        `,v.appendChild(t)})}function P(){const e=d.value.trim(),t=l.value.trim();if(!t&&!e)return;const i={id:Date.now().toString(),title:e,content:t,updatedAt:Date.now()};a.unshift(i),h(),u(),d.value="",l.value=""}function q(e){a=a.filter(t=>t.id!==e),h(),u()}function h(){localStorage.setItem("cloud_notes",JSON.stringify(a))}async function b(){if(!T)return g("Google API no cargada");f("Sincronizando...");try{const t=(await gapi.client.drive.files.list({q:`name = '${E}' and trashed = false`,fields:"files(id, name)"})).result.files;let i=t.length>0?t[0].id:null;if(i){const n=(await gapi.client.drive.files.get({fileId:i,alt:"media"})).result,o=[...a];n.forEach(s=>{const c=o.findIndex(p=>p.id===s.id);c===-1?o.push(s):s.updatedAt>o[c].updatedAt&&(o[c]=s)}),a=o,h(),u()}await j(i),f("Sincronizado"),g("Notas sincronizadas con éxito")}catch(e){console.error("Sync error:",e),f("Error al sincronizar"),e.status===401&&S()}}async function j(e){var i;const t=(i=gapi.auth.getToken())==null?void 0:i.access_token;if(!t)throw{status:401,message:"No access token"};if(e){const r=await fetch(`https://www.googleapis.com/upload/drive/v3/files/${e}?uploadType=media`,{method:"PATCH",headers:new Headers({Authorization:"Bearer "+t}),body:JSON.stringify(a)});if(!r.ok)throw new Error("Update failed");return r}else{const r="-------314159265358979323846",n=`\r
--`+r+`\r
`,o=`\r
--`+r+"--",s="application/json",c={name:E,mimeType:s},p=n+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(c)+n+"Content-Type: "+s+`\r
\r
`+JSON.stringify(a)+o,y=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:"Bearer "+t,"Content-Type":"multipart/related; boundary="+r}),body:p});if(!y.ok)throw new Error("Creation failed");return y}}function g(e){const t=document.getElementById("toast");t.innerText=e,t.classList.remove("translate-y-20","opacity-0"),setTimeout(()=>{t.classList.add("translate-y-20","opacity-0")},3e3)}function f(e){C.classList.remove("hidden"),O.innerText=e}window.deleteNote=q;
